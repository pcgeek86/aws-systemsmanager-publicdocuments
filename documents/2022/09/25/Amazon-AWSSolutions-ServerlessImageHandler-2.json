{
  "AttachmentsContent": [],
  "Content": "{\n  \"schemaVersion\" : \"1.0\",\n  \"description\" : \"(SO0023) - Serverless Image Handler. Version v6.0.0\",\n  \"templateBody\" : {\n    \"Description\" : \"(SO0023) - Serverless Image Handler. Version v6.0.0\",\n    \"Metadata\" : {\n      \"AWS::CloudFormation::Interface\" : {\n        \"ParameterGroups\" : [ {\n          \"Label\" : {\n            \"default\" : \"CORS Options\"\n          },\n          \"Parameters\" : [ \"CorsEnabledParameter\", \"CorsOriginParameter\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"Image Sources\"\n          },\n          \"Parameters\" : [ \"SourceBucketsParameter\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"Demo UI\"\n          },\n          \"Parameters\" : [ \"DeployDemoUIParameter\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"Event Logging\"\n          },\n          \"Parameters\" : [ \"LogRetentionPeriodParameter\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"Image URL Signature (Note: Enabling signature is not compatible with previous image URLs, which could result in broken image links. Please refer to the implementation guide for details: https://docs.aws.amazon.com/solutions/latest/serverless-image-handler/considerations.html)\"\n          },\n          \"Parameters\" : [ \"EnableSignatureParameter\", \"SecretsManagerSecretParameter\", \"SecretsManagerKeyParameter\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"Default Fallback Image (Note: Enabling default fallback image returns the default fallback image instead of JSON object when error happens. Please refer to the implementation guide for details: https://docs.aws.amazon.com/solutions/latest/serverless-image-handler/considerations.html)\"\n          },\n          \"Parameters\" : [ \"EnableDefaultFallbackImageParameter\", \"FallbackImageS3BucketParameter\", \"FallbackImageS3KeyParameter\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"Auto WebP\"\n          },\n          \"Parameters\" : [ \"AutoWebPParameter\" ]\n        } ],\n        \"ParameterLabels\" : {\n          \"CorsEnabledParameter\" : {\n            \"default\" : \"CORS Enabled\"\n          },\n          \"CorsOriginParameter\" : {\n            \"default\" : \"CORS Origin\"\n          },\n          \"SourceBucketsParameter\" : {\n            \"default\" : \"Source Buckets\"\n          },\n          \"DeployDemoUIParameter\" : {\n            \"default\" : \"Deploy Demo UI\"\n          },\n          \"LogRetentionPeriodParameter\" : {\n            \"default\" : \"Log Retention Period\"\n          },\n          \"AutoWebPParameter\" : {\n            \"default\" : \"AutoWebP\"\n          },\n          \"EnableSignatureParameter\" : {\n            \"default\" : \"Enable Signature\"\n          },\n          \"SecretsManagerSecretParameter\" : {\n            \"default\" : \"SecretsManager Secret\"\n          },\n          \"SecretsManagerKeyParameter\" : {\n            \"default\" : \"SecretsManager Key\"\n          },\n          \"EnableDefaultFallbackImageParameter\" : {\n            \"default\" : \"Enable Default Fallback Image\"\n          },\n          \"FallbackImageS3BucketParameter\" : {\n            \"default\" : \"Fallback Image S3 Bucket\"\n          },\n          \"FallbackImageS3KeyParameter\" : {\n            \"default\" : \"Fallback Image S3 Key\"\n          },\n          \"CloudFrontPriceClassParameter\" : {\n            \"default\" : \"CloudFront PriceClass\"\n          }\n        }\n      }\n    },\n    \"Parameters\" : {\n      \"CorsEnabledParameter\" : {\n        \"Type\" : \"String\",\n        \"Default\" : false,\n        \"AllowedValues\" : [ true, false ],\n        \"Description\" : \"Would you like to enable Cross-Origin Resource Sharing (CORS) for the image handler API? Select 'Yes' if so.\"\n      },\n      \"CorsOriginParameter\" : {\n        \"Type\" : \"String\",\n        \"Default\" : \"*\",\n        \"Description\" : \"If you selected 'Yes' above, please specify an origin value here. A wildcard (*) value will support any origin. We recommend specifying an origin (i.e. https://example.domain) to restrict cross-site access to your API.\"\n      },\n      \"SourceBucketsParameter\" : {\n        \"Type\" : \"String\",\n        \"Default\" : \"defaultBucket, bucketNo2, bucketNo3, ...\",\n        \"AllowedPattern\" : \".+\",\n        \"Description\" : \"(Required) List the buckets (comma-separated) within your account that contain original image files. If you plan to use Thumbor or Custom image requests with this solution, the source bucket for those requests will be the first bucket listed in this field.\"\n      },\n      \"DeployDemoUIParameter\" : {\n        \"Type\" : \"String\",\n        \"Default\" : true,\n        \"AllowedValues\" : [ true, false ],\n        \"Description\" : \"Would you like to deploy a demo UI to explore the features and capabilities of this solution? This will create an additional Amazon S3 bucket and Amazon CloudFront distribution in your account.\"\n      },\n      \"LogRetentionPeriodParameter\" : {\n        \"Type\" : \"Number\",\n        \"Default\" : \"1\",\n        \"AllowedValues\" : [ \"1\", \"3\", \"5\", \"7\", \"14\", \"30\", \"60\", \"90\", \"120\", \"150\", \"180\", \"365\", \"400\", \"545\", \"731\", \"1827\", \"3653\" ],\n        \"Description\" : \"This solution automatically logs events to Amazon CloudWatch. Select the amount of time for CloudWatch logs from this solution to be retained (in days).\"\n      },\n      \"AutoWebPParameter\" : {\n        \"Type\" : \"String\",\n        \"Default\" : false,\n        \"AllowedValues\" : [ true, false ],\n        \"Description\" : \"Would you like to enable automatic WebP based on accept headers? Select 'Yes' if so.\"\n      },\n      \"EnableSignatureParameter\" : {\n        \"Type\" : \"String\",\n        \"Default\" : false,\n        \"AllowedValues\" : [ true, false ],\n        \"Description\" : \"Would you like to enable the signature? If so, select 'Yes' and provide SecretsManagerSecret and SecretsManagerKey values.\"\n      },\n      \"SecretsManagerSecretParameter\" : {\n        \"Type\" : \"String\",\n        \"Default\" : \"\",\n        \"Description\" : \"The name of AWS Secrets Manager secret. You need to create your secret under this name.\"\n      },\n      \"SecretsManagerKeyParameter\" : {\n        \"Type\" : \"String\",\n        \"Default\" : \"\",\n        \"Description\" : \"The name of AWS Secrets Manager secret key. You need to create secret key with this key name. The secret value would be used to check signature.\"\n      },\n      \"EnableDefaultFallbackImageParameter\" : {\n        \"Type\" : \"String\",\n        \"Default\" : false,\n        \"AllowedValues\" : [ true, false ],\n        \"Description\" : \"Would you like to enable the default fallback image? If so, select 'Yes' and provide FallbackImageS3Bucket and FallbackImageS3Key values.\"\n      },\n      \"FallbackImageS3BucketParameter\" : {\n        \"Type\" : \"String\",\n        \"Default\" : \"\",\n        \"Description\" : \"The name of the Amazon S3 bucket which contains the default fallback image. e.g. my-fallback-image-bucket\"\n      },\n      \"FallbackImageS3KeyParameter\" : {\n        \"Type\" : \"String\",\n        \"Default\" : \"\",\n        \"Description\" : \"The name of the default fallback image object key including prefix. e.g. prefix/image.jpg\"\n      },\n      \"CloudFrontPriceClassParameter\" : {\n        \"Type\" : \"String\",\n        \"Default\" : \"PriceClass_All\",\n        \"AllowedValues\" : [ \"PriceClass_All\", \"PriceClass_200\", \"PriceClass_100\" ],\n        \"Description\" : \"The AWS CloudFront price class to use. For more information see: https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/PriceClass.html\"\n      }\n    },\n    \"Conditions\" : {\n      \"CommonResourcesDeployDemoUICondition308D3B09\" : {\n        \"Fn::Equals\" : [ {\n          \"Ref\" : \"DeployDemoUIParameter\"\n        }, true ]\n      },\n      \"CommonResourcesEnableSignatureCondition909DC7A1\" : {\n        \"Fn::Equals\" : [ {\n          \"Ref\" : \"EnableSignatureParameter\"\n        }, true ]\n      },\n      \"CommonResourcesEnableDefaultFallbackImageConditionD1A10983\" : {\n        \"Fn::Equals\" : [ {\n          \"Ref\" : \"EnableDefaultFallbackImageParameter\"\n        }, true ]\n      },\n      \"CommonResourcesEnableCorsConditionA0615348\" : {\n        \"Fn::Equals\" : [ {\n          \"Ref\" : \"CorsEnabledParameter\"\n        }, true ]\n      },\n      \"CDKMetadataAvailable\" : {\n        \"Fn::Or\" : [ {\n          \"Fn::Or\" : [ {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"af-south-1\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"ap-east-1\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"ap-northeast-1\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"ap-northeast-2\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"ap-south-1\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"ap-southeast-1\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"ap-southeast-2\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"ca-central-1\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"cn-north-1\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"cn-northwest-1\" ]\n          } ]\n        }, {\n          \"Fn::Or\" : [ {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"eu-central-1\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"eu-north-1\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"eu-south-1\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"eu-west-1\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"eu-west-2\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"eu-west-3\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"me-south-1\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"sa-east-1\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"us-east-1\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"us-east-2\" ]\n          } ]\n        }, {\n          \"Fn::Or\" : [ {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"us-west-1\" ]\n          }, {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"AWS::Region\"\n            }, \"us-west-2\" ]\n          } ]\n        } ]\n      }\n    },\n    \"Resources\" : {\n      \"CommonResourcesSecretsManagerPolicy45FE005E\" : {\n        \"Type\" : \"AWS::IAM::Policy\",\n        \"Properties\" : {\n          \"PolicyDocument\" : {\n            \"Statement\" : [ {\n              \"Action\" : \"secretsmanager:GetSecretValue\",\n              \"Effect\" : \"Allow\",\n              \"Resource\" : {\n                \"Fn::Join\" : [ \"\", [ \"arn:\", {\n                  \"Ref\" : \"AWS::Partition\"\n                }, \":secretsmanager:\", {\n                  \"Ref\" : \"AWS::Region\"\n                }, \":\", {\n                  \"Ref\" : \"AWS::AccountId\"\n                }, \":secret:\", {\n                  \"Ref\" : \"SecretsManagerSecretParameter\"\n                }, \"*\" ] ]\n              }\n            } ],\n            \"Version\" : \"2012-10-17\"\n          },\n          \"PolicyName\" : \"CommonResourcesSecretsManagerPolicy45FE005E\",\n          \"Roles\" : [ {\n            \"Ref\" : \"CommonResourcesCustomResourcesCustomResourceRole8958A1ED\"\n          }, {\n            \"Ref\" : \"BackEndImageHandlerFunctionRoleABF81E5C\"\n          } ]\n        },\n        \"Condition\" : \"CommonResourcesEnableSignatureCondition909DC7A1\"\n      },\n      \"CommonResourcesCustomResourcesCustomResourceRole8958A1ED\" : {\n        \"Type\" : \"AWS::IAM::Role\",\n        \"Properties\" : {\n          \"AssumeRolePolicyDocument\" : {\n            \"Statement\" : [ {\n              \"Action\" : \"sts:AssumeRole\",\n              \"Effect\" : \"Allow\",\n              \"Principal\" : {\n                \"Service\" : \"lambda.amazonaws.com\"\n              }\n            } ],\n            \"Version\" : \"2012-10-17\"\n          },\n          \"Path\" : \"/\",\n          \"Policies\" : [ {\n            \"PolicyDocument\" : {\n              \"Statement\" : [ {\n                \"Action\" : [ \"logs:CreateLogGroup\", \"logs:CreateLogStream\", \"logs:PutLogEvents\" ],\n                \"Effect\" : \"Allow\",\n                \"Resource\" : {\n                  \"Fn::Join\" : [ \"\", [ \"arn:\", {\n                    \"Ref\" : \"AWS::Partition\"\n                  }, \":logs:\", {\n                    \"Ref\" : \"AWS::Region\"\n                  }, \":\", {\n                    \"Ref\" : \"AWS::AccountId\"\n                  }, \":log-group:/aws/lambda/*\" ] ]\n                }\n              }, {\n                \"Action\" : [ \"s3:putBucketAcl\", \"s3:putEncryptionConfiguration\", \"s3:putBucketPolicy\", \"s3:CreateBucket\", \"s3:GetObject\", \"s3:PutObject\", \"s3:ListBucket\" ],\n                \"Effect\" : \"Allow\",\n                \"Resource\" : {\n                  \"Fn::Join\" : [ \"\", [ \"arn:\", {\n                    \"Ref\" : \"AWS::Partition\"\n                  }, \":s3:::*\" ] ]\n                }\n              } ],\n              \"Version\" : \"2012-10-17\"\n            },\n            \"PolicyName\" : \"CloudWatchLogsPolicy\"\n          }, {\n            \"PolicyDocument\" : {\n              \"Statement\" : [ {\n                \"Action\" : \"ec2:DescribeRegions\",\n                \"Effect\" : \"Allow\",\n                \"Resource\" : \"*\"\n              } ],\n              \"Version\" : \"2012-10-17\"\n            },\n            \"PolicyName\" : \"EC2Policy\"\n          } ],\n          \"Tags\" : [ {\n            \"Key\" : \"SolutionId\",\n            \"Value\" : \"SO0023\"\n          } ]\n        },\n        \"Metadata\" : {\n          \"cfn_nag\" : {\n            \"rules_to_suppress\" : [ {\n              \"id\" : \"W11\",\n              \"reason\" : \"Allow '*' because it is required for making DescribeRegions API call as it doesn't support resource-level permissions and require to choose all resources.\"\n            } ]\n          }\n        }\n      },\n      \"CommonResourcesCustomResourcesCustomResourceRoleDefaultPolicy5AE1B0FC\" : {\n        \"Type\" : \"AWS::IAM::Policy\",\n        \"Properties\" : {\n          \"PolicyDocument\" : {\n            \"Statement\" : [ {\n              \"Action\" : [ \"s3:GetObject*\", \"s3:GetBucket*\", \"s3:List*\" ],\n              \"Effect\" : \"Allow\",\n              \"Resource\" : [ {\n                \"Fn::Join\" : [ \"\", [ \"arn:\", {\n                  \"Ref\" : \"AWS::Partition\"\n                }, \":s3:::solutions-\", {\n                  \"Ref\" : \"AWS::Region\"\n                } ] ]\n              }, {\n                \"Fn::Join\" : [ \"\", [ \"arn:\", {\n                  \"Ref\" : \"AWS::Partition\"\n                }, \":s3:::solutions-\", {\n                  \"Ref\" : \"AWS::Region\"\n                }, \"/serverless-image-handler/v6.0.0/*\" ] ]\n              } ]\n            } ],\n            \"Version\" : \"2012-10-17\"\n          },\n          \"PolicyName\" : \"CommonResourcesCustomResourcesCustomResourceRoleDefaultPolicy5AE1B0FC\",\n          \"Roles\" : [ {\n            \"Ref\" : \"CommonResourcesCustomResourcesCustomResourceRole8958A1ED\"\n          } ]\n        }\n      },\n      \"CommonResourcesCustomResourcesCustomResourceFunction0D924235\" : {\n        \"Type\" : \"AWS::Lambda::Function\",\n        \"Properties\" : {\n          \"Code\" : {\n            \"S3Bucket\" : {\n              \"Fn::Join\" : [ \"\", [ \"solutions-\", {\n                \"Ref\" : \"AWS::Region\"\n              } ] ]\n            },\n            \"S3Key\" : \"serverless-image-handler/v6.0.0/custom-resource.zip\"\n          },\n          \"Role\" : {\n            \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesCustomResourceRole8958A1ED\", \"Arn\" ]\n          },\n          \"Description\" : \"Serverless Image Handler (v6.0.0): Custom resource\",\n          \"Environment\" : {\n            \"Variables\" : {\n              \"SOLUTION_ID\" : \"SO0023\",\n              \"RETRY_SECONDS\" : \"5\",\n              \"SOLUTION_VERSION\" : \"v6.0.0\"\n            }\n          },\n          \"Handler\" : \"custom-resource/index.handler\",\n          \"MemorySize\" : 128,\n          \"Runtime\" : \"nodejs14.x\",\n          \"Tags\" : [ {\n            \"Key\" : \"SolutionId\",\n            \"Value\" : \"SO0023\"\n          } ],\n          \"Timeout\" : 60\n        },\n        \"DependsOn\" : [ \"CommonResourcesCustomResourcesCustomResourceRoleDefaultPolicy5AE1B0FC\", \"CommonResourcesCustomResourcesCustomResourceRole8958A1ED\" ],\n        \"Metadata\" : {\n          \"cfn_nag\" : {\n            \"rules_to_suppress\" : [ {\n              \"id\" : \"W58\",\n              \"reason\" : \"The function does have permission to write CloudWatch Logs.\"\n            }, {\n              \"id\" : \"W89\",\n              \"reason\" : \"The Lambda function does not require any VPC connection at all.\"\n            }, {\n              \"id\" : \"W92\",\n              \"reason\" : \"The Lambda function does not require ReservedConcurrentExecutions.\"\n            } ]\n          }\n        }\n      },\n      \"CommonResourcesCustomResourcesCustomResourceUuid64E7CCAD\" : {\n        \"Type\" : \"AWS::CloudFormation::CustomResource\",\n        \"Properties\" : {\n          \"ServiceToken\" : {\n            \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesCustomResourceFunction0D924235\", \"Arn\" ]\n          },\n          \"Region\" : {\n            \"Ref\" : \"AWS::Region\"\n          },\n          \"CustomAction\" : \"createUuid\"\n        },\n        \"UpdateReplacePolicy\" : \"Delete\",\n        \"DeletionPolicy\" : \"Delete\"\n      },\n      \"CommonResourcesCustomResourcesLogBucketCustomResource2445A3AB\" : {\n        \"Type\" : \"AWS::CloudFormation::CustomResource\",\n        \"Properties\" : {\n          \"ServiceToken\" : {\n            \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesCustomResourceFunction0D924235\", \"Arn\" ]\n          },\n          \"CustomAction\" : \"createCloudFrontLoggingBucket\",\n          \"BucketSuffix\" : {\n            \"Fn::Join\" : [ \"\", [ {\n              \"Ref\" : \"AWS::StackName\"\n            }, \"-\", {\n              \"Ref\" : \"AWS::Region\"\n            }, \"-\", {\n              \"Ref\" : \"AWS::AccountId\"\n            } ] ]\n          }\n        },\n        \"UpdateReplacePolicy\" : \"Delete\",\n        \"DeletionPolicy\" : \"Delete\"\n      },\n      \"CommonResourcesCustomResourcesCustomResourceAnonymousMetric51363F57\" : {\n        \"Type\" : \"AWS::CloudFormation::CustomResource\",\n        \"Properties\" : {\n          \"ServiceToken\" : {\n            \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesCustomResourceFunction0D924235\", \"Arn\" ]\n          },\n          \"CustomAction\" : \"sendMetric\",\n          \"Region\" : {\n            \"Ref\" : \"AWS::Region\"\n          },\n          \"UUID\" : {\n            \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesCustomResourceUuid64E7CCAD\", \"UUID\" ]\n          },\n          \"AnonymousData\" : true,\n          \"CorsEnabled\" : {\n            \"Ref\" : \"CorsEnabledParameter\"\n          },\n          \"SourceBuckets\" : {\n            \"Ref\" : \"SourceBucketsParameter\"\n          },\n          \"DeployDemoUi\" : {\n            \"Ref\" : \"DeployDemoUIParameter\"\n          },\n          \"LogRetentionPeriod\" : {\n            \"Ref\" : \"LogRetentionPeriodParameter\"\n          },\n          \"AutoWebP\" : {\n            \"Ref\" : \"AutoWebPParameter\"\n          },\n          \"EnableSignature\" : {\n            \"Ref\" : \"EnableSignatureParameter\"\n          },\n          \"EnableDefaultFallbackImage\" : {\n            \"Ref\" : \"EnableDefaultFallbackImageParameter\"\n          }\n        },\n        \"UpdateReplacePolicy\" : \"Delete\",\n        \"DeletionPolicy\" : \"Delete\"\n      },\n      \"CommonResourcesCustomResourcesCustomResourceCheckSourceBucketsA313C9B7\" : {\n        \"Type\" : \"AWS::CloudFormation::CustomResource\",\n        \"Properties\" : {\n          \"ServiceToken\" : {\n            \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesCustomResourceFunction0D924235\", \"Arn\" ]\n          },\n          \"CustomAction\" : \"checkSourceBuckets\",\n          \"Region\" : {\n            \"Ref\" : \"AWS::Region\"\n          },\n          \"SourceBuckets\" : {\n            \"Ref\" : \"SourceBucketsParameter\"\n          }\n        },\n        \"UpdateReplacePolicy\" : \"Delete\",\n        \"DeletionPolicy\" : \"Delete\"\n      },\n      \"CommonResourcesCustomResourcesCustomResourceCheckFallbackImage6CE45571\" : {\n        \"Type\" : \"AWS::CloudFormation::CustomResource\",\n        \"Properties\" : {\n          \"ServiceToken\" : {\n            \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesCustomResourceFunction0D924235\", \"Arn\" ]\n          },\n          \"CustomAction\" : \"checkFallbackImage\",\n          \"FallbackImageS3Bucket\" : {\n            \"Ref\" : \"FallbackImageS3BucketParameter\"\n          },\n          \"FallbackImageS3Key\" : {\n            \"Ref\" : \"FallbackImageS3KeyParameter\"\n          }\n        },\n        \"UpdateReplacePolicy\" : \"Delete\",\n        \"DeletionPolicy\" : \"Delete\",\n        \"Condition\" : \"CommonResourcesEnableDefaultFallbackImageConditionD1A10983\"\n      },\n      \"CommonResourcesCustomResourcesCustomResourceCheckSecretsManagerAEEEC776\" : {\n        \"Type\" : \"AWS::CloudFormation::CustomResource\",\n        \"Properties\" : {\n          \"ServiceToken\" : {\n            \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesCustomResourceFunction0D924235\", \"Arn\" ]\n          },\n          \"CustomAction\" : \"checkSecretsManager\",\n          \"SecretsManagerName\" : {\n            \"Ref\" : \"SecretsManagerSecretParameter\"\n          },\n          \"SecretsManagerKey\" : {\n            \"Ref\" : \"SecretsManagerKeyParameter\"\n          }\n        },\n        \"UpdateReplacePolicy\" : \"Delete\",\n        \"DeletionPolicy\" : \"Delete\",\n        \"Condition\" : \"CommonResourcesEnableSignatureCondition909DC7A1\"\n      },\n      \"CommonResourcesCustomResourcesCopyWebsite83738AA9\" : {\n        \"Type\" : \"AWS::CloudFormation::CustomResource\",\n        \"Properties\" : {\n          \"ServiceToken\" : {\n            \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesCustomResourceFunction0D924235\", \"Arn\" ]\n          },\n          \"CustomAction\" : \"copyS3assets\",\n          \"Region\" : {\n            \"Ref\" : \"AWS::Region\"\n          },\n          \"ManifestKey\" : \"serverless-image-handler/v6.0.0/demo-ui-manifest.json\",\n          \"SourceS3Bucket\" : {\n            \"Fn::Join\" : [ \"\", [ \"solutions-\", {\n              \"Ref\" : \"AWS::Region\"\n            } ] ]\n          },\n          \"SourceS3key\" : \"serverless-image-handler/v6.0.0/demo-ui\",\n          \"DestS3Bucket\" : {\n            \"Ref\" : \"FrontEndDistributionToS3S3Bucket3A171D78\"\n          },\n          \"Version\" : \"v6.0.0\"\n        },\n        \"UpdateReplacePolicy\" : \"Delete\",\n        \"DeletionPolicy\" : \"Delete\",\n        \"Condition\" : \"CommonResourcesDeployDemoUICondition308D3B09\"\n      },\n      \"CommonResourcesCustomResourcesPutWebsiteConfigC4E435F3\" : {\n        \"Type\" : \"AWS::CloudFormation::CustomResource\",\n        \"Properties\" : {\n          \"ServiceToken\" : {\n            \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesCustomResourceFunction0D924235\", \"Arn\" ]\n          },\n          \"CustomAction\" : \"putConfigFile\",\n          \"Region\" : {\n            \"Ref\" : \"AWS::Region\"\n          },\n          \"ConfigItem\" : {\n            \"apiEndpoint\" : {\n              \"Fn::Join\" : [ \"\", [ \"https://\", {\n                \"Fn::GetAtt\" : [ \"BackEndImageHandlerCloudFrontApiGatewayLambdaCloudFrontToApiGatewayCloudFrontDistribution03AA31B2\", \"DomainName\" ]\n              } ] ]\n            }\n          },\n          \"DestS3Bucket\" : {\n            \"Ref\" : \"FrontEndDistributionToS3S3Bucket3A171D78\"\n          },\n          \"DestS3key\" : \"demo-ui-config.js\"\n        },\n        \"UpdateReplacePolicy\" : \"Delete\",\n        \"DeletionPolicy\" : \"Delete\",\n        \"Condition\" : \"CommonResourcesDeployDemoUICondition308D3B09\"\n      },\n      \"FrontEndDistributionToS3S3Bucket3A171D78\" : {\n        \"Type\" : \"AWS::S3::Bucket\",\n        \"Properties\" : {\n          \"BucketEncryption\" : {\n            \"ServerSideEncryptionConfiguration\" : [ {\n              \"ServerSideEncryptionByDefault\" : {\n                \"SSEAlgorithm\" : \"AES256\"\n              }\n            } ]\n          },\n          \"LifecycleConfiguration\" : {\n            \"Rules\" : [ {\n              \"NoncurrentVersionTransitions\" : [ {\n                \"StorageClass\" : \"GLACIER\",\n                \"TransitionInDays\" : 90\n              } ],\n              \"Status\" : \"Enabled\"\n            } ]\n          },\n          \"PublicAccessBlockConfiguration\" : {\n            \"BlockPublicAcls\" : true,\n            \"BlockPublicPolicy\" : true,\n            \"IgnorePublicAcls\" : true,\n            \"RestrictPublicBuckets\" : true\n          },\n          \"Tags\" : [ {\n            \"Key\" : \"SolutionId\",\n            \"Value\" : \"SO0023\"\n          } ],\n          \"VersioningConfiguration\" : {\n            \"Status\" : \"Enabled\"\n          }\n        },\n        \"UpdateReplacePolicy\" : \"Retain\",\n        \"DeletionPolicy\" : \"Retain\",\n        \"Metadata\" : {\n          \"cfn_nag\" : {\n            \"rules_to_suppress\" : [ {\n              \"id\" : \"W35\",\n              \"reason\" : \"This S3 bucket does not require access logging.\"\n            } ]\n          }\n        },\n        \"Condition\" : \"CommonResourcesDeployDemoUICondition308D3B09\"\n      },\n      \"FrontEndDistributionToS3S3BucketPolicyF3A0315A\" : {\n        \"Type\" : \"AWS::S3::BucketPolicy\",\n        \"Properties\" : {\n          \"Bucket\" : {\n            \"Ref\" : \"FrontEndDistributionToS3S3Bucket3A171D78\"\n          },\n          \"PolicyDocument\" : {\n            \"Statement\" : [ {\n              \"Action\" : \"*\",\n              \"Condition\" : {\n                \"Bool\" : {\n                  \"aws:SecureTransport\" : \"false\"\n                }\n              },\n              \"Effect\" : \"Deny\",\n              \"Principal\" : {\n                \"AWS\" : \"*\"\n              },\n              \"Resource\" : [ {\n                \"Fn::Join\" : [ \"\", [ {\n                  \"Fn::GetAtt\" : [ \"FrontEndDistributionToS3S3Bucket3A171D78\", \"Arn\" ]\n                }, \"/*\" ] ]\n              }, {\n                \"Fn::GetAtt\" : [ \"FrontEndDistributionToS3S3Bucket3A171D78\", \"Arn\" ]\n              } ],\n              \"Sid\" : \"HttpsOnly\"\n            }, {\n              \"Action\" : \"s3:GetObject\",\n              \"Effect\" : \"Allow\",\n              \"Principal\" : {\n                \"CanonicalUser\" : {\n                  \"Fn::GetAtt\" : [ \"FrontEndDistributionToS3CloudFrontDistributionOrigin1S3OriginD10E575E\", \"S3CanonicalUserId\" ]\n                }\n              },\n              \"Resource\" : {\n                \"Fn::Join\" : [ \"\", [ {\n                  \"Fn::GetAtt\" : [ \"FrontEndDistributionToS3S3Bucket3A171D78\", \"Arn\" ]\n                }, \"/*\" ] ]\n              }\n            } ],\n            \"Version\" : \"2012-10-17\"\n          }\n        },\n        \"Metadata\" : {\n          \"cfn_nag\" : {\n            \"rules_to_suppress\" : [ {\n              \"id\" : \"F16\",\n              \"reason\" : \"Public website bucket policy requires a wildcard principal\"\n            } ]\n          }\n        },\n        \"Condition\" : \"CommonResourcesDeployDemoUICondition308D3B09\"\n      },\n      \"FrontEndDistributionToS3CloudFrontDistributionOrigin1S3OriginD10E575E\" : {\n        \"Type\" : \"AWS::CloudFront::CloudFrontOriginAccessIdentity\",\n        \"Properties\" : {\n          \"CloudFrontOriginAccessIdentityConfig\" : {\n            \"Comment\" : \"Identity for ServerlessImageHandlerStackFrontEndDistributionToS3CloudFrontDistributionOrigin140765BF6\"\n          }\n        },\n        \"Condition\" : \"CommonResourcesDeployDemoUICondition308D3B09\"\n      },\n      \"FrontEndDistributionToS3CloudFrontDistribution15FE13D0\" : {\n        \"Type\" : \"AWS::CloudFront::Distribution\",\n        \"Properties\" : {\n          \"DistributionConfig\" : {\n            \"Comment\" : \"Demo UI Distribution for Serverless Image Handler\",\n            \"CustomErrorResponses\" : [ {\n              \"ErrorCode\" : 403,\n              \"ResponseCode\" : 200,\n              \"ResponsePagePath\" : \"/index.html\"\n            }, {\n              \"ErrorCode\" : 404,\n              \"ResponseCode\" : 200,\n              \"ResponsePagePath\" : \"/index.html\"\n            } ],\n            \"DefaultCacheBehavior\" : {\n              \"CachePolicyId\" : \"658327ea-f89d-4fab-a63d-7e88639e58f6\",\n              \"Compress\" : true,\n              \"TargetOriginId\" : \"ServerlessImageHandlerStackFrontEndDistributionToS3CloudFrontDistributionOrigin140765BF6\",\n              \"ViewerProtocolPolicy\" : \"redirect-to-https\"\n            },\n            \"DefaultRootObject\" : \"index.html\",\n            \"Enabled\" : true,\n            \"HttpVersion\" : \"http2\",\n            \"IPV6Enabled\" : true,\n            \"Logging\" : {\n              \"Bucket\" : {\n                \"Fn::Join\" : [ \"\", [ {\n                  \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesLogBucketCustomResource2445A3AB\", \"BucketName\" ]\n                }, \".s3.\", {\n                  \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesLogBucketCustomResource2445A3AB\", \"Region\" ]\n                }, \".\", {\n                  \"Ref\" : \"AWS::URLSuffix\"\n                } ] ]\n              },\n              \"Prefix\" : \"ui-cloudfront/\"\n            },\n            \"Origins\" : [ {\n              \"DomainName\" : {\n                \"Fn::GetAtt\" : [ \"FrontEndDistributionToS3S3Bucket3A171D78\", \"RegionalDomainName\" ]\n              },\n              \"Id\" : \"ServerlessImageHandlerStackFrontEndDistributionToS3CloudFrontDistributionOrigin140765BF6\",\n              \"S3OriginConfig\" : {\n                \"OriginAccessIdentity\" : {\n                  \"Fn::Join\" : [ \"\", [ \"origin-access-identity/cloudfront/\", {\n                    \"Ref\" : \"FrontEndDistributionToS3CloudFrontDistributionOrigin1S3OriginD10E575E\"\n                  } ] ]\n                }\n              }\n            } ]\n          },\n          \"Tags\" : [ {\n            \"Key\" : \"SolutionId\",\n            \"Value\" : \"SO0023\"\n          } ]\n        },\n        \"Metadata\" : {\n          \"cfn_nag\" : {\n            \"rules_to_suppress\" : [ {\n              \"id\" : \"W70\",\n              \"reason\" : \"Since the distribution uses the CloudFront domain name, CloudFront automatically sets the security policy to TLSv1 regardless of the value of MinimumProtocolVersion\"\n            } ]\n          }\n        },\n        \"Condition\" : \"CommonResourcesDeployDemoUICondition308D3B09\"\n      },\n      \"BackEndImageHandlerFunctionRoleABF81E5C\" : {\n        \"Type\" : \"AWS::IAM::Role\",\n        \"Properties\" : {\n          \"AssumeRolePolicyDocument\" : {\n            \"Statement\" : [ {\n              \"Action\" : \"sts:AssumeRole\",\n              \"Effect\" : \"Allow\",\n              \"Principal\" : {\n                \"Service\" : \"lambda.amazonaws.com\"\n              }\n            } ],\n            \"Version\" : \"2012-10-17\"\n          },\n          \"Path\" : \"/\",\n          \"Tags\" : [ {\n            \"Key\" : \"SolutionId\",\n            \"Value\" : \"SO0023\"\n          } ]\n        }\n      },\n      \"BackEndImageHandlerFunctionPolicy437940B5\" : {\n        \"Type\" : \"AWS::IAM::Policy\",\n        \"Properties\" : {\n          \"PolicyDocument\" : {\n            \"Statement\" : [ {\n              \"Action\" : [ \"logs:CreateLogGroup\", \"logs:CreateLogStream\", \"logs:PutLogEvents\" ],\n              \"Effect\" : \"Allow\",\n              \"Resource\" : {\n                \"Fn::Join\" : [ \"\", [ \"arn:\", {\n                  \"Ref\" : \"AWS::Partition\"\n                }, \":logs:\", {\n                  \"Ref\" : \"AWS::Region\"\n                }, \":\", {\n                  \"Ref\" : \"AWS::AccountId\"\n                }, \":log-group:/aws/lambda/*\" ] ]\n              }\n            }, {\n              \"Action\" : [ \"s3:GetObject\", \"s3:PutObject\", \"s3:ListBucket\" ],\n              \"Effect\" : \"Allow\",\n              \"Resource\" : {\n                \"Fn::Join\" : [ \"\", [ \"arn:\", {\n                  \"Ref\" : \"AWS::Partition\"\n                }, \":s3:::*\" ] ]\n              }\n            }, {\n              \"Action\" : [ \"rekognition:DetectFaces\", \"rekognition:DetectModerationLabels\" ],\n              \"Effect\" : \"Allow\",\n              \"Resource\" : \"*\"\n            } ],\n            \"Version\" : \"2012-10-17\"\n          },\n          \"PolicyName\" : \"BackEndImageHandlerFunctionPolicy437940B5\",\n          \"Roles\" : [ {\n            \"Ref\" : \"BackEndImageHandlerFunctionRoleABF81E5C\"\n          } ]\n        },\n        \"Metadata\" : {\n          \"cfn_nag\" : {\n            \"rules_to_suppress\" : [ {\n              \"id\" : \"W12\",\n              \"reason\" : \"rekognition:DetectFaces requires '*' resources.\"\n            } ]\n          }\n        }\n      },\n      \"BackEndImageHandlerLambdaFunctionADEF7FF2\" : {\n        \"Type\" : \"AWS::Lambda::Function\",\n        \"Properties\" : {\n          \"Code\" : {\n            \"S3Bucket\" : {\n              \"Fn::Join\" : [ \"\", [ \"solutions-\", {\n                \"Ref\" : \"AWS::Region\"\n              } ] ]\n            },\n            \"S3Key\" : \"serverless-image-handler/v6.0.0/image-handler.zip\"\n          },\n          \"Role\" : {\n            \"Fn::GetAtt\" : [ \"BackEndImageHandlerFunctionRoleABF81E5C\", \"Arn\" ]\n          },\n          \"Description\" : \"Serverless Image Handler (v6.0.0): Performs image edits and manipulations\",\n          \"Environment\" : {\n            \"Variables\" : {\n              \"AUTO_WEBP\" : {\n                \"Ref\" : \"AutoWebPParameter\"\n              },\n              \"CORS_ENABLED\" : {\n                \"Ref\" : \"CorsEnabledParameter\"\n              },\n              \"CORS_ORIGIN\" : {\n                \"Ref\" : \"CorsOriginParameter\"\n              },\n              \"SOURCE_BUCKETS\" : {\n                \"Ref\" : \"SourceBucketsParameter\"\n              },\n              \"REWRITE_MATCH_PATTERN\" : \"\",\n              \"REWRITE_SUBSTITUTION\" : \"\",\n              \"ENABLE_SIGNATURE\" : {\n                \"Ref\" : \"EnableSignatureParameter\"\n              },\n              \"SECRETS_MANAGER\" : {\n                \"Ref\" : \"SecretsManagerSecretParameter\"\n              },\n              \"SECRET_KEY\" : {\n                \"Ref\" : \"SecretsManagerKeyParameter\"\n              },\n              \"ENABLE_DEFAULT_FALLBACK_IMAGE\" : {\n                \"Ref\" : \"EnableDefaultFallbackImageParameter\"\n              },\n              \"DEFAULT_FALLBACK_IMAGE_BUCKET\" : {\n                \"Ref\" : \"FallbackImageS3BucketParameter\"\n              },\n              \"DEFAULT_FALLBACK_IMAGE_KEY\" : {\n                \"Ref\" : \"FallbackImageS3KeyParameter\"\n              }\n            }\n          },\n          \"Handler\" : \"image-handler/index.handler\",\n          \"MemorySize\" : 1024,\n          \"Runtime\" : \"nodejs14.x\",\n          \"Tags\" : [ {\n            \"Key\" : \"SolutionId\",\n            \"Value\" : \"SO0023\"\n          } ],\n          \"Timeout\" : 900\n        },\n        \"DependsOn\" : [ \"BackEndImageHandlerFunctionRoleABF81E5C\" ],\n        \"Metadata\" : {\n          \"cfn_nag\" : {\n            \"rules_to_suppress\" : [ {\n              \"id\" : \"W58\",\n              \"reason\" : \"The function does have permission to write CloudWatch Logs.\"\n            }, {\n              \"id\" : \"W89\",\n              \"reason\" : \"The Lambda function does not require any VPC connection at all.\"\n            }, {\n              \"id\" : \"W92\",\n              \"reason\" : \"The Lambda function does not require ReservedConcurrentExecutions.\"\n            } ]\n          }\n        }\n      },\n      \"BackEndImageHandlerLogGroupA0941EEC\" : {\n        \"Type\" : \"AWS::Logs::LogGroup\",\n        \"Properties\" : {\n          \"LogGroupName\" : {\n            \"Fn::Join\" : [ \"\", [ \"/aws/lambda/\", {\n              \"Ref\" : \"BackEndImageHandlerLambdaFunctionADEF7FF2\"\n            } ] ]\n          },\n          \"RetentionInDays\" : {\n            \"Ref\" : \"LogRetentionPeriodParameter\"\n          },\n          \"Tags\" : [ {\n            \"Key\" : \"SolutionId\",\n            \"Value\" : \"SO0023\"\n          } ]\n        },\n        \"UpdateReplacePolicy\" : \"Retain\",\n        \"DeletionPolicy\" : \"Retain\",\n        \"Metadata\" : {\n          \"cfn_nag\" : {\n            \"rules_to_suppress\" : [ {\n              \"id\" : \"W84\",\n              \"reason\" : \"CloudWatch log group is always encrypted by default.\"\n            } ]\n          }\n        }\n      },\n      \"BackEndCachePolicy1DCE9B1B\" : {\n        \"Type\" : \"AWS::CloudFront::CachePolicy\",\n        \"Properties\" : {\n          \"CachePolicyConfig\" : {\n            \"DefaultTTL\" : 86400,\n            \"MaxTTL\" : 31536000,\n            \"MinTTL\" : 1,\n            \"Name\" : {\n              \"Fn::Join\" : [ \"\", [ \"ServerlessImageHandler-\", {\n                \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesCustomResourceUuid64E7CCAD\", \"UUID\" ]\n              } ] ]\n            },\n            \"ParametersInCacheKeyAndForwardedToOrigin\" : {\n              \"CookiesConfig\" : {\n                \"CookieBehavior\" : \"none\"\n              },\n              \"EnableAcceptEncodingBrotli\" : false,\n              \"EnableAcceptEncodingGzip\" : true,\n              \"HeadersConfig\" : {\n                \"HeaderBehavior\" : \"whitelist\",\n                \"Headers\" : [ \"origin\", \"accept\" ]\n              },\n              \"QueryStringsConfig\" : {\n                \"QueryStringBehavior\" : \"whitelist\",\n                \"QueryStrings\" : [ \"signature\" ]\n              }\n            }\n          }\n        }\n      },\n      \"BackEndOriginRequestPolicy771345D7\" : {\n        \"Type\" : \"AWS::CloudFront::OriginRequestPolicy\",\n        \"Properties\" : {\n          \"OriginRequestPolicyConfig\" : {\n            \"CookiesConfig\" : {\n              \"CookieBehavior\" : \"none\"\n            },\n            \"HeadersConfig\" : {\n              \"HeaderBehavior\" : \"whitelist\",\n              \"Headers\" : [ \"origin\", \"accept\" ]\n            },\n            \"Name\" : {\n              \"Fn::Join\" : [ \"\", [ \"ServerlessImageHandler-\", {\n                \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesCustomResourceUuid64E7CCAD\", \"UUID\" ]\n              } ] ]\n            },\n            \"QueryStringsConfig\" : {\n              \"QueryStringBehavior\" : \"whitelist\",\n              \"QueryStrings\" : [ \"signature\" ]\n            }\n          }\n        }\n      },\n      \"BackEndImageHandlerCloudFrontApiGatewayLambdaApiAccessLogGroup9B786692\" : {\n        \"Type\" : \"AWS::Logs::LogGroup\",\n        \"Properties\" : {\n          \"RetentionInDays\" : {\n            \"Ref\" : \"LogRetentionPeriodParameter\"\n          },\n          \"Tags\" : [ {\n            \"Key\" : \"SolutionId\",\n            \"Value\" : \"SO0023\"\n          } ]\n        },\n        \"UpdateReplacePolicy\" : \"Retain\",\n        \"DeletionPolicy\" : \"Retain\",\n        \"Metadata\" : {\n          \"cfn_nag\" : {\n            \"rules_to_suppress\" : [ {\n              \"id\" : \"W84\",\n              \"reason\" : \"By default CloudWatchLogs LogGroups data is encrypted using the CloudWatch server-side encryption keys (AWS Managed Keys)\"\n            } ]\n          }\n        }\n      },\n      \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApi5A77D109\" : {\n        \"Type\" : \"AWS::ApiGateway::RestApi\",\n        \"Properties\" : {\n          \"BinaryMediaTypes\" : [ \"*/*\" ],\n          \"EndpointConfiguration\" : {\n            \"Types\" : [ \"REGIONAL\" ]\n          },\n          \"Name\" : \"LambdaRestApi\",\n          \"Tags\" : [ {\n            \"Key\" : \"SolutionId\",\n            \"Value\" : \"SO0023\"\n          } ]\n        }\n      },\n      \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiDeployment663240D64e4983e311b7a4ac4c0f406aed3f92e2\" : {\n        \"Type\" : \"AWS::ApiGateway::Deployment\",\n        \"Properties\" : {\n          \"RestApiId\" : {\n            \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApi5A77D109\"\n          },\n          \"Description\" : \"Automatically created by the RestApi construct\"\n        },\n        \"DependsOn\" : [ \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiproxyANY8F9763E1\", \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiproxyBDF0A131\", \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiANYE4494B31\" ],\n        \"Metadata\" : {\n          \"cfn_nag\" : {\n            \"rules_to_suppress\" : [ {\n              \"id\" : \"W45\",\n              \"reason\" : \"ApiGateway has AccessLogging enabled in AWS::ApiGateway::Stage resource, but cfn_nag checkes for it in AWS::ApiGateway::Deployment resource\"\n            } ]\n          }\n        }\n      },\n      \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiDeploymentStageimageB55D20E3\" : {\n        \"Type\" : \"AWS::ApiGateway::Stage\",\n        \"Properties\" : {\n          \"RestApiId\" : {\n            \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApi5A77D109\"\n          },\n          \"AccessLogSetting\" : {\n            \"DestinationArn\" : {\n              \"Fn::GetAtt\" : [ \"BackEndImageHandlerCloudFrontApiGatewayLambdaApiAccessLogGroup9B786692\", \"Arn\" ]\n            },\n            \"Format\" : \"{\\\"requestId\\\":\\\"$context.requestId\\\",\\\"ip\\\":\\\"$context.identity.sourceIp\\\",\\\"user\\\":\\\"$context.identity.user\\\",\\\"caller\\\":\\\"$context.identity.caller\\\",\\\"requestTime\\\":\\\"$context.requestTime\\\",\\\"httpMethod\\\":\\\"$context.httpMethod\\\",\\\"resourcePath\\\":\\\"$context.resourcePath\\\",\\\"status\\\":\\\"$context.status\\\",\\\"protocol\\\":\\\"$context.protocol\\\",\\\"responseLength\\\":\\\"$context.responseLength\\\"}\"\n          },\n          \"DeploymentId\" : {\n            \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiDeployment663240D64e4983e311b7a4ac4c0f406aed3f92e2\"\n          },\n          \"MethodSettings\" : [ {\n            \"DataTraceEnabled\" : false,\n            \"HttpMethod\" : \"*\",\n            \"LoggingLevel\" : \"INFO\",\n            \"ResourcePath\" : \"/*\"\n          } ],\n          \"StageName\" : \"image\",\n          \"Tags\" : [ {\n            \"Key\" : \"SolutionId\",\n            \"Value\" : \"SO0023\"\n          } ],\n          \"TracingEnabled\" : true\n        }\n      },\n      \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiproxyBDF0A131\" : {\n        \"Type\" : \"AWS::ApiGateway::Resource\",\n        \"Properties\" : {\n          \"ParentId\" : {\n            \"Fn::GetAtt\" : [ \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApi5A77D109\", \"RootResourceId\" ]\n          },\n          \"PathPart\" : \"{proxy+}\",\n          \"RestApiId\" : {\n            \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApi5A77D109\"\n          }\n        }\n      },\n      \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiproxyANYApiPermissionServerlessImageHandlerStackBackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiF7C63563ANYproxy4E0EC93E\" : {\n        \"Type\" : \"AWS::Lambda::Permission\",\n        \"Properties\" : {\n          \"Action\" : \"lambda:InvokeFunction\",\n          \"FunctionName\" : {\n            \"Fn::GetAtt\" : [ \"BackEndImageHandlerLambdaFunctionADEF7FF2\", \"Arn\" ]\n          },\n          \"Principal\" : \"apigateway.amazonaws.com\",\n          \"SourceArn\" : {\n            \"Fn::Join\" : [ \"\", [ \"arn:\", {\n              \"Ref\" : \"AWS::Partition\"\n            }, \":execute-api:\", {\n              \"Ref\" : \"AWS::Region\"\n            }, \":\", {\n              \"Ref\" : \"AWS::AccountId\"\n            }, \":\", {\n              \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApi5A77D109\"\n            }, \"/\", {\n              \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiDeploymentStageimageB55D20E3\"\n            }, \"/*/*\" ] ]\n          }\n        }\n      },\n      \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiproxyANYApiPermissionTestServerlessImageHandlerStackBackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiF7C63563ANYproxyE40ABA2A\" : {\n        \"Type\" : \"AWS::Lambda::Permission\",\n        \"Properties\" : {\n          \"Action\" : \"lambda:InvokeFunction\",\n          \"FunctionName\" : {\n            \"Fn::GetAtt\" : [ \"BackEndImageHandlerLambdaFunctionADEF7FF2\", \"Arn\" ]\n          },\n          \"Principal\" : \"apigateway.amazonaws.com\",\n          \"SourceArn\" : {\n            \"Fn::Join\" : [ \"\", [ \"arn:\", {\n              \"Ref\" : \"AWS::Partition\"\n            }, \":execute-api:\", {\n              \"Ref\" : \"AWS::Region\"\n            }, \":\", {\n              \"Ref\" : \"AWS::AccountId\"\n            }, \":\", {\n              \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApi5A77D109\"\n            }, \"/test-invoke-stage/*/*\" ] ]\n          }\n        }\n      },\n      \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiproxyANY8F9763E1\" : {\n        \"Type\" : \"AWS::ApiGateway::Method\",\n        \"Properties\" : {\n          \"HttpMethod\" : \"ANY\",\n          \"ResourceId\" : {\n            \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiproxyBDF0A131\"\n          },\n          \"RestApiId\" : {\n            \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApi5A77D109\"\n          },\n          \"AuthorizationType\" : \"NONE\",\n          \"Integration\" : {\n            \"IntegrationHttpMethod\" : \"POST\",\n            \"Type\" : \"AWS_PROXY\",\n            \"Uri\" : {\n              \"Fn::Join\" : [ \"\", [ \"arn:\", {\n                \"Ref\" : \"AWS::Partition\"\n              }, \":apigateway:\", {\n                \"Ref\" : \"AWS::Region\"\n              }, \":lambda:path/2015-03-31/functions/\", {\n                \"Fn::GetAtt\" : [ \"BackEndImageHandlerLambdaFunctionADEF7FF2\", \"Arn\" ]\n              }, \"/invocations\" ] ]\n            }\n          }\n        },\n        \"Metadata\" : {\n          \"cfn_nag\" : {\n            \"rules_to_suppress\" : [ {\n              \"id\" : \"W59\",\n              \"reason\" : \"AWS::ApiGateway::Method AuthorizationType is set to 'NONE' because API Gateway behind CloudFront does not support AWS_IAM authentication\"\n            } ]\n          }\n        }\n      },\n      \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiANYApiPermissionServerlessImageHandlerStackBackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiF7C63563ANY3D47D314\" : {\n        \"Type\" : \"AWS::Lambda::Permission\",\n        \"Properties\" : {\n          \"Action\" : \"lambda:InvokeFunction\",\n          \"FunctionName\" : {\n            \"Fn::GetAtt\" : [ \"BackEndImageHandlerLambdaFunctionADEF7FF2\", \"Arn\" ]\n          },\n          \"Principal\" : \"apigateway.amazonaws.com\",\n          \"SourceArn\" : {\n            \"Fn::Join\" : [ \"\", [ \"arn:\", {\n              \"Ref\" : \"AWS::Partition\"\n            }, \":execute-api:\", {\n              \"Ref\" : \"AWS::Region\"\n            }, \":\", {\n              \"Ref\" : \"AWS::AccountId\"\n            }, \":\", {\n              \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApi5A77D109\"\n            }, \"/\", {\n              \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiDeploymentStageimageB55D20E3\"\n            }, \"/*/\" ] ]\n          }\n        }\n      },\n      \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiANYApiPermissionTestServerlessImageHandlerStackBackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiF7C63563ANYE1780638\" : {\n        \"Type\" : \"AWS::Lambda::Permission\",\n        \"Properties\" : {\n          \"Action\" : \"lambda:InvokeFunction\",\n          \"FunctionName\" : {\n            \"Fn::GetAtt\" : [ \"BackEndImageHandlerLambdaFunctionADEF7FF2\", \"Arn\" ]\n          },\n          \"Principal\" : \"apigateway.amazonaws.com\",\n          \"SourceArn\" : {\n            \"Fn::Join\" : [ \"\", [ \"arn:\", {\n              \"Ref\" : \"AWS::Partition\"\n            }, \":execute-api:\", {\n              \"Ref\" : \"AWS::Region\"\n            }, \":\", {\n              \"Ref\" : \"AWS::AccountId\"\n            }, \":\", {\n              \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApi5A77D109\"\n            }, \"/test-invoke-stage/*/\" ] ]\n          }\n        }\n      },\n      \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiANYE4494B31\" : {\n        \"Type\" : \"AWS::ApiGateway::Method\",\n        \"Properties\" : {\n          \"HttpMethod\" : \"ANY\",\n          \"ResourceId\" : {\n            \"Fn::GetAtt\" : [ \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApi5A77D109\", \"RootResourceId\" ]\n          },\n          \"RestApiId\" : {\n            \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApi5A77D109\"\n          },\n          \"AuthorizationType\" : \"NONE\",\n          \"Integration\" : {\n            \"IntegrationHttpMethod\" : \"POST\",\n            \"Type\" : \"AWS_PROXY\",\n            \"Uri\" : {\n              \"Fn::Join\" : [ \"\", [ \"arn:\", {\n                \"Ref\" : \"AWS::Partition\"\n              }, \":apigateway:\", {\n                \"Ref\" : \"AWS::Region\"\n              }, \":lambda:path/2015-03-31/functions/\", {\n                \"Fn::GetAtt\" : [ \"BackEndImageHandlerLambdaFunctionADEF7FF2\", \"Arn\" ]\n              }, \"/invocations\" ] ]\n            }\n          }\n        },\n        \"Metadata\" : {\n          \"cfn_nag\" : {\n            \"rules_to_suppress\" : [ {\n              \"id\" : \"W59\",\n              \"reason\" : \"AWS::ApiGateway::Method AuthorizationType is set to 'NONE' because API Gateway behind CloudFront does not support AWS_IAM authentication\"\n            } ]\n          }\n        }\n      },\n      \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiUsagePlan76CA1E70\" : {\n        \"Type\" : \"AWS::ApiGateway::UsagePlan\",\n        \"Properties\" : {\n          \"ApiStages\" : [ {\n            \"ApiId\" : {\n              \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApi5A77D109\"\n            },\n            \"Stage\" : {\n              \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiDeploymentStageimageB55D20E3\"\n            },\n            \"Throttle\" : { }\n          } ],\n          \"Tags\" : [ {\n            \"Key\" : \"SolutionId\",\n            \"Value\" : \"SO0023\"\n          } ]\n        }\n      },\n      \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiCloudWatchRole12575C4D\" : {\n        \"Type\" : \"AWS::IAM::Role\",\n        \"Properties\" : {\n          \"AssumeRolePolicyDocument\" : {\n            \"Statement\" : [ {\n              \"Action\" : \"sts:AssumeRole\",\n              \"Effect\" : \"Allow\",\n              \"Principal\" : {\n                \"Service\" : \"apigateway.amazonaws.com\"\n              }\n            } ],\n            \"Version\" : \"2012-10-17\"\n          },\n          \"Policies\" : [ {\n            \"PolicyDocument\" : {\n              \"Statement\" : [ {\n                \"Action\" : [ \"logs:CreateLogGroup\", \"logs:CreateLogStream\", \"logs:DescribeLogGroups\", \"logs:DescribeLogStreams\", \"logs:PutLogEvents\", \"logs:GetLogEvents\", \"logs:FilterLogEvents\" ],\n                \"Effect\" : \"Allow\",\n                \"Resource\" : {\n                  \"Fn::Join\" : [ \"\", [ \"arn:\", {\n                    \"Ref\" : \"AWS::Partition\"\n                  }, \":logs:\", {\n                    \"Ref\" : \"AWS::Region\"\n                  }, \":\", {\n                    \"Ref\" : \"AWS::AccountId\"\n                  }, \":*\" ] ]\n                }\n              } ],\n              \"Version\" : \"2012-10-17\"\n            },\n            \"PolicyName\" : \"LambdaRestApiCloudWatchRolePolicy\"\n          } ],\n          \"Tags\" : [ {\n            \"Key\" : \"SolutionId\",\n            \"Value\" : \"SO0023\"\n          } ]\n        }\n      },\n      \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiAccountE5522E5D\" : {\n        \"Type\" : \"AWS::ApiGateway::Account\",\n        \"Properties\" : {\n          \"CloudWatchRoleArn\" : {\n            \"Fn::GetAtt\" : [ \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApiCloudWatchRole12575C4D\", \"Arn\" ]\n          }\n        },\n        \"DependsOn\" : [ \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApi5A77D109\" ]\n      },\n      \"BackEndImageHandlerCloudFrontApiGatewayLambdaCloudFrontToApiGatewayCloudFrontDistribution03AA31B2\" : {\n        \"Type\" : \"AWS::CloudFront::Distribution\",\n        \"Properties\" : {\n          \"DistributionConfig\" : {\n            \"Comment\" : \"Image Handler Distribution for Serverless Image Handler\",\n            \"CustomErrorResponses\" : [ {\n              \"ErrorCachingMinTTL\" : 600,\n              \"ErrorCode\" : 500\n            }, {\n              \"ErrorCachingMinTTL\" : 600,\n              \"ErrorCode\" : 501\n            }, {\n              \"ErrorCachingMinTTL\" : 600,\n              \"ErrorCode\" : 502\n            }, {\n              \"ErrorCachingMinTTL\" : 600,\n              \"ErrorCode\" : 503\n            }, {\n              \"ErrorCachingMinTTL\" : 600,\n              \"ErrorCode\" : 504\n            } ],\n            \"DefaultCacheBehavior\" : {\n              \"AllowedMethods\" : [ \"GET\", \"HEAD\" ],\n              \"CachePolicyId\" : {\n                \"Ref\" : \"BackEndCachePolicy1DCE9B1B\"\n              },\n              \"Compress\" : true,\n              \"OriginRequestPolicyId\" : {\n                \"Ref\" : \"BackEndOriginRequestPolicy771345D7\"\n              },\n              \"TargetOriginId\" : \"verlessImageHandlerStackBackEndImageHandlerCloudFrontApiGatewayLambdaCloudFrontToApiGatewayCloudFrontDistributionOrigin1BEFA9FF3\",\n              \"ViewerProtocolPolicy\" : \"https-only\"\n            },\n            \"Enabled\" : true,\n            \"HttpVersion\" : \"http2\",\n            \"IPV6Enabled\" : true,\n            \"Logging\" : {\n              \"Bucket\" : {\n                \"Fn::Join\" : [ \"\", [ {\n                  \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesLogBucketCustomResource2445A3AB\", \"BucketName\" ]\n                }, \".s3.\", {\n                  \"Fn::GetAtt\" : [ \"CommonResourcesCustomResourcesLogBucketCustomResource2445A3AB\", \"Region\" ]\n                }, \".\", {\n                  \"Ref\" : \"AWS::URLSuffix\"\n                } ] ]\n              },\n              \"Prefix\" : \"api-cloudfront/\"\n            },\n            \"Origins\" : [ {\n              \"CustomOriginConfig\" : {\n                \"OriginProtocolPolicy\" : \"https-only\",\n                \"OriginSSLProtocols\" : [ \"TLSv1.1\", \"TLSv1.2\" ]\n              },\n              \"DomainName\" : {\n                \"Fn::Join\" : [ \"\", [ {\n                  \"Ref\" : \"BackEndImageHandlerCloudFrontApiGatewayLambdaLambdaRestApi5A77D109\"\n                }, \".execute-api.\", {\n                  \"Ref\" : \"AWS::Region\"\n                }, \".amazonaws.com\" ] ]\n              },\n              \"Id\" : \"verlessImageHandlerStackBackEndImageHandlerCloudFrontApiGatewayLambdaCloudFrontToApiGatewayCloudFrontDistributionOrigin1BEFA9FF3\",\n              \"OriginPath\" : \"/image\"\n            } ],\n            \"PriceClass\" : {\n              \"Ref\" : \"CloudFrontPriceClassParameter\"\n            }\n          },\n          \"Tags\" : [ {\n            \"Key\" : \"SolutionId\",\n            \"Value\" : \"SO0023\"\n          } ]\n        },\n        \"Metadata\" : {\n          \"cfn_nag\" : {\n            \"rules_to_suppress\" : [ {\n              \"id\" : \"W70\",\n              \"reason\" : \"Since the distribution uses the CloudFront domain name, CloudFront automatically sets the security policy to TLSv1 regardless of the value of MinimumProtocolVersion\"\n            } ]\n          }\n        }\n      },\n      \"CDKMetadata\" : {\n        \"Type\" : \"AWS::CDK::Metadata\",\n        \"Properties\" : {\n          \"Analytics\" : \"v2:deflate64:H4sIAAAAAAAA/3VS0U7DMAz8lr23GWMSz0CnISQQ1YAPyFKvhLVxiRNgivrvuMmmdtKQIuUusRP7zguxWN6Iq9mt/KE8qGo/DwotiPDqpNpnxc6U0soWHNiBPMuu06bOCjTkrFduOGRSaafRZIUnh+0GCL1VMNxN8Yt3nXd9Fr/SshWhxEarQ/wloQ02KY33PqOlCPde7cHdS4IsweH6iNI2PjLlfdbIdltJEdbeqFTdzkxxCbbVRMz6TDXoq51F40RYaW5Nb32Me7G61uZOKSB6rMA47eJXxZCwHhL+izh7ppDqA8ZCpzTlb+DLA016uXDMLWFNIjxh/WDRd0PYCbOqna6lgx95EIFVd3edjqo9RRmOJ0dLIlxB1+Ch5YpjuSNj6+voQgInC+NrpcXfw0WDn8F9YBWHJKF34uyykVHsM8JioTeu79libKJClKvTSNF8GJDRkTzwHIx6v+HrctJsfrR5GsDdPaTbN0ztT9W5HMm1GKxAfNL8e3EtrnnNPknr3HKlugWxSfsf4LrmWjEDAAA=\"\n        },\n        \"Condition\" : \"CDKMetadataAvailable\"\n      }\n    },\n    \"Outputs\" : {\n      \"ApiEndpoint\" : {\n        \"Description\" : \"Link to API endpoint for sending image requests to.\",\n        \"Value\" : {\n          \"Fn::Join\" : [ \"\", [ \"https://\", {\n            \"Fn::GetAtt\" : [ \"BackEndImageHandlerCloudFrontApiGatewayLambdaCloudFrontToApiGatewayCloudFrontDistribution03AA31B2\", \"DomainName\" ]\n          } ] ]\n        }\n      },\n      \"DemoUrl\" : {\n        \"Description\" : \"Link to the demo user interface for the solution.\",\n        \"Value\" : {\n          \"Fn::Join\" : [ \"\", [ \"https://\", {\n            \"Fn::GetAtt\" : [ \"FrontEndDistributionToS3CloudFrontDistribution15FE13D0\", \"DomainName\" ]\n          }, \"/index.html\" ] ]\n        },\n        \"Condition\" : \"CommonResourcesDeployDemoUICondition308D3B09\"\n      },\n      \"SourceBuckets\" : {\n        \"Description\" : \"Amazon S3 bucket location containing original image files.\",\n        \"Value\" : {\n          \"Ref\" : \"SourceBucketsParameter\"\n        }\n      },\n      \"CorsEnabled\" : {\n        \"Description\" : \"Indicates whether Cross-Origin Resource Sharing (CORS) has been enabled for the image handler API.\",\n        \"Value\" : {\n          \"Ref\" : \"CorsEnabledParameter\"\n        }\n      },\n      \"CorsOrigin\" : {\n        \"Description\" : \"Origin value returned in the Access-Control-Allow-Origin header of image handler API responses.\",\n        \"Value\" : {\n          \"Ref\" : \"CorsOriginParameter\"\n        },\n        \"Condition\" : \"CommonResourcesEnableCorsConditionA0615348\"\n      },\n      \"LogRetentionPeriod\" : {\n        \"Description\" : \"Number of days for event logs from Lambda to be retained in CloudWatch.\",\n        \"Value\" : {\n          \"Ref\" : \"LogRetentionPeriodParameter\"\n        }\n      }\n    }\n  }\n}",
  "CreatedDate": "2022-04-01T22:26:32.678Z",
  "DisplayName": null,
  "DocumentFormat": {
    "Value": "JSON"
  },
  "DocumentType": {
    "Value": "CloudFormation"
  },
  "DocumentVersion": "2",
  "Name": "AWSSolutions-ServerlessImageHandler",
  "Requires": [],
  "ReviewStatus": null,
  "Status": {
    "Value": "Active"
  },
  "StatusInformation": null,
  "VersionName": "serverless-image-handler-v6.0.0",
  "ResponseMetadata": {
    "RequestId": "fbbb451e-477a-40ac-9655-8ab24d720d35",
    "Metadata": {},
    "ChecksumAlgorithm": 0,
    "ChecksumValidationStatus": 0
  },
  "ContentLength": 61665,
  "HttpStatusCode": 200,
  "LoggedAt": "2022-09-25T07:15:41.0547966+00:00"
}
