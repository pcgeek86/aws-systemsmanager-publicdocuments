{
  "AttachmentsContent": [],
  "Content": "{\n  \"schemaVersion\" : \"1.0\",\n  \"description\" : \"This template creates a VPC infrastructure for a multi-AZ, multi-tier deployment of a Windows based Application infrastructure. It will deploy a Remote Desktop Gateway and managed NAT gateways into the public subnet for each Availability Zone. **WARNING** This template creates Amazon EC2 Windows instance and related resources.  You will be billed for the AWS resources used if you create a stack from this template. (qs-1qup6rafe)\",\n  \"templateBody\" : {\n    \"AWSTemplateFormatVersion\" : \"2010-09-09\",\n    \"Description\" : \"This template creates a VPC infrastructure for a multi-AZ, multi-tier deployment of a Windows based Application infrastructure. It will deploy a Remote Desktop Gateway and managed NAT gateways into the public subnet for each Availability Zone. **WARNING** This template creates Amazon EC2 Windows instance and related resources.  You will be billed for the AWS resources used if you create a stack from this template. (qs-1qup6rafe)\",\n    \"Metadata\" : {\n      \"QuickStartDocumentation\" : {\n        \"EntrypointName\" : \"Parameters for deploying into a new VPC\"\n      },\n      \"AWS::CloudFormation::Interface\" : {\n        \"ParameterGroups\" : [ {\n          \"Label\" : {\n            \"default\" : \"Network configuration\"\n          },\n          \"Parameters\" : [ \"AvailabilityZones\", \"VPCTenancy\", \"VPCCIDR\", \"PrivateSubnet1CIDR\", \"PrivateSubnet2CIDR\", \"PublicSubnet1CIDR\", \"PublicSubnet2CIDR\", \"RDGWCIDR\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"Amazon EC2 configuration\"\n          },\n          \"Parameters\" : [ \"KeyPairName\", \"RDGWInstanceType\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"Microsoft Remote Desktop Gateway configuration\"\n          },\n          \"Parameters\" : [ \"NumberOfRDGWHosts\", \"AdminUser\", \"AdminPassword\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"AWS Quick Start configuration\"\n          },\n          \"Parameters\" : [ \"QSS3BucketName\", \"QSS3KeyPrefix\", \"QSS3BucketRegion\" ]\n        } ],\n        \"ParameterLabels\" : {\n          \"AvailabilityZones\" : {\n            \"default\" : \"Availability Zones\"\n          },\n          \"AdminPassword\" : {\n            \"default\" : \"Admin password\"\n          },\n          \"AdminUser\" : {\n            \"default\" : \"Admin user name\"\n          },\n          \"KeyPairName\" : {\n            \"default\" : \"Key pair name\"\n          },\n          \"NumberOfRDGWHosts\" : {\n            \"default\" : \"Number of RDGW hosts\"\n          },\n          \"PrivateSubnet1CIDR\" : {\n            \"default\" : \"Private subnet 1 CIDR\"\n          },\n          \"PrivateSubnet2CIDR\" : {\n            \"default\" : \"Private subnet 2 CIDR\"\n          },\n          \"PublicSubnet1CIDR\" : {\n            \"default\" : \"Public subnet 1 CIDR\"\n          },\n          \"PublicSubnet2CIDR\" : {\n            \"default\" : \"Public subnet 2 CIDR\"\n          },\n          \"QSS3BucketName\" : {\n            \"default\" : \"Quick Start S3 bucket name\"\n          },\n          \"QSS3KeyPrefix\" : {\n            \"default\" : \"Quick Start S3 key prefix\"\n          },\n          \"QSS3BucketRegion\" : {\n            \"default\" : \"Quick Start S3 bucket Region\"\n          },\n          \"RDGWInstanceType\" : {\n            \"default\" : \"Remote Desktop Gateway instance type\"\n          },\n          \"RDGWCIDR\" : {\n            \"default\" : \"Allowed Remote Desktop Gateway external access CIDR\"\n          },\n          \"VPCCIDR\" : {\n            \"default\" : \"VPC CIDR\"\n          },\n          \"VPCTenancy\" : {\n            \"default\" : \"VPC tenancy\"\n          }\n        }\n      }\n    },\n    \"Parameters\" : {\n      \"AdminPassword\" : {\n        \"Description\" : \"Password for the administrative account. Must be at least 8 characters containing letters, numbers and symbols.\",\n        \"Type\" : \"String\",\n        \"MinLength\" : \"8\",\n        \"MaxLength\" : \"32\",\n        \"AllowedPattern\" : \"(?=^.{6,255}$)((?=.*\\\\d)(?=.*[A-Z])(?=.*[a-z])|(?=.*\\\\d)(?=.*[^A-Za-z0-9])(?=.*[a-z])|(?=.*[^A-Za-z0-9])(?=.*[A-Z])(?=.*[a-z])|(?=.*\\\\d)(?=.*[A-Z])(?=.*[^A-Za-z0-9]))^.*\",\n        \"NoEcho\" : \"true\"\n      },\n      \"AdminUser\" : {\n        \"Description\" : \"User name for the new local administrator account.\",\n        \"Type\" : \"String\",\n        \"Default\" : \"StackAdmin\",\n        \"MinLength\" : \"5\",\n        \"MaxLength\" : \"25\",\n        \"AllowedPattern\" : \"[a-zA-Z0-9]*\"\n      },\n      \"AvailabilityZones\" : {\n        \"Description\" : \"List of Availability Zones (AZs) to use for the subnets in the VPC. Note: The logical order is preserved and only 2 AZs are used for this deployment.\",\n        \"Type\" : \"List<AWS::EC2::AvailabilityZone::Name>\"\n      },\n      \"KeyPairName\" : {\n        \"Description\" : \"Public/private key pairs allow you to securely connect to your instance after it launches.\",\n        \"Type\" : \"AWS::EC2::KeyPair::KeyName\"\n      },\n      \"NumberOfRDGWHosts\" : {\n        \"AllowedValues\" : [ \"1\", \"2\", \"3\", \"4\" ],\n        \"Default\" : \"1\",\n        \"Description\" : \"Enter the number of Remote Desktop Gateway hosts to create.\",\n        \"Type\" : \"String\"\n      },\n      \"PrivateSubnet1CIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/(1[6-9]|2[0-8]))$\",\n        \"ConstraintDescription\" : \"CIDR block parameter must be in the form x.x.x.x/16-28.\",\n        \"Default\" : \"10.0.0.0/19\",\n        \"Description\" : \"CIDR block for private subnet 1 located in Availability Zone 1.\",\n        \"Type\" : \"String\"\n      },\n      \"PrivateSubnet2CIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/(1[6-9]|2[0-8]))$\",\n        \"ConstraintDescription\" : \"CIDR block parameter must be in the form x.x.x.x/16-28.\",\n        \"Default\" : \"10.0.32.0/19\",\n        \"Description\" : \"CIDR block for private subnet 2 located in Availability Zone 2.\",\n        \"Type\" : \"String\"\n      },\n      \"PublicSubnet1CIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/(1[6-9]|2[0-8]))$\",\n        \"ConstraintDescription\" : \"CIDR block parameter must be in the form x.x.x.x/16-28.\",\n        \"Default\" : \"10.0.128.0/20\",\n        \"Description\" : \"CIDR Block for the public DMZ subnet 1 located in Availability Zone 1.\",\n        \"Type\" : \"String\"\n      },\n      \"PublicSubnet2CIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/(1[6-9]|2[0-8]))$\",\n        \"ConstraintDescription\" : \"CIDR block parameter must be in the form x.x.x.x/16-28.\",\n        \"Default\" : \"10.0.144.0/20\",\n        \"Description\" : \"CIDR Block for the public DMZ subnet 2 located in Availability Zone 2.\",\n        \"Type\" : \"String\"\n      },\n      \"QSS3BucketName\" : {\n        \"AllowedPattern\" : \"^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$\",\n        \"ConstraintDescription\" : \"The Quick Start bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).\",\n        \"Default\" : \"aws-quickstart\",\n        \"Description\" : \"Name of the S3 bucket for your copy of the Quick Start assets. Keep the default name unless you are customizing the template. Changing the name updates code references to point to a new Quick Start location. This name can include numbers, lowercase letters, uppercase letters, and hyphens, but do not start or end with a hyphen (-). See https://aws-quickstart.github.io/option1.html.\",\n        \"Type\" : \"String\"\n      },\n      \"QSS3KeyPrefix\" : {\n        \"AllowedPattern\" : \"^[0-9a-zA-Z-/]*$\",\n        \"ConstraintDescription\" : \"The Quick Start S3 key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).\",\n        \"Default\" : \"quickstart-microsoft-rdgateway/\",\n        \"Description\" : \"S3 key prefix that is used to simulate a directory for your copy of the Quick Start assets. Keep the default prefix unless you are customizing the template. Changing this prefix updates code references to point to a new Quick Start location. This prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slashes (/). See https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingMetadata.html and https://aws-quickstart.github.io/option1.html.\",\n        \"Type\" : \"String\"\n      },\n      \"QSS3BucketRegion\" : {\n        \"Default\" : \"us-east-1\",\n        \"Description\" : \"Region of staging bucket (BucketName).\",\n        \"Type\" : \"String\"\n      },\n      \"RDGWInstanceType\" : {\n        \"Description\" : \"Amazon EC2 instance type for the Remote Desktop Gateway instances.\",\n        \"Type\" : \"String\",\n        \"Default\" : \"t3.2xlarge\",\n        \"AllowedValues\" : [ \"t2.large\", \"t3.micro\", \"t3.small\", \"t3.medium\", \"t3.large\", \"t3.xlarge\", \"t3.2xlarge\", \"t3a.micro\", \"t3a.small\", \"t3a.medium\", \"t3a.large\", \"t3a.xlarge\", \"t3a.2xlarge\", \"m5.large\", \"m5.xlarge\", \"m5.2xlarge\", \"m5a.large\", \"m5a.xlarge\", \"m5a.2xlarge\" ]\n      },\n      \"RDGWCIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/([0-9]|[1-2][0-9]|3[0-2]))$\",\n        \"ConstraintDescription\" : \"CIDR block parameter must be in the form x.x.x.x/x.\",\n        \"Description\" : \"Allowed CIDR block for external access to the Remote Desktop Gateways.\",\n        \"Type\" : \"String\"\n      },\n      \"VPCCIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/(1[6-9]|2[0-8]))$\",\n        \"ConstraintDescription\" : \"CIDR block parameter must be in the form x.x.x.x/16-28.\",\n        \"Default\" : \"10.0.0.0/16\",\n        \"Description\" : \"CIDR block for the VPC.\",\n        \"Type\" : \"String\"\n      },\n      \"VPCTenancy\" : {\n        \"AllowedValues\" : [ \"default\", \"dedicated\" ],\n        \"Default\" : \"default\",\n        \"Description\" : \"The allowed tenancy of instances launched into the VPC.\",\n        \"Type\" : \"String\"\n      }\n    },\n    \"Rules\" : {\n      \"CheckSupportedInstances\" : {\n        \"RuleCondition\" : {\n          \"Fn::Not\" : [ {\n            \"Fn::Not\" : [ {\n              \"Fn::Contains\" : [ [ \"m4.xlarge\", \"m4.2xlarge\", \"m4.4xlarge\", \"m4.large\" ], {\n                \"Ref\" : \"RDGWInstanceType\"\n              } ]\n            } ]\n          } ]\n        },\n        \"Assertions\" : [ {\n          \"Assert\" : {\n            \"Fn::Not\" : [ {\n              \"Fn::Contains\" : [ [ \"eu-west-3\" ], {\n                \"Ref\" : \"AWS::Region\"\n              } ]\n            } ]\n          },\n          \"AssertDescription\" : \"M4 instances are not available in the Paris region.\"\n        } ]\n      }\n    },\n    \"Conditions\" : {\n      \"UsingDefaultBucket\" : {\n        \"Fn::Equals\" : [ {\n          \"Ref\" : \"QSS3BucketName\"\n        }, \"aws-quickstart\" ]\n      }\n    },\n    \"Resources\" : {\n      \"VPCStack\" : {\n        \"Type\" : \"AWS::CloudFormation::Stack\",\n        \"Properties\" : {\n          \"TemplateURL\" : {\n            \"Fn::Sub\" : \"ssm-doc://arn:${AWS::Partition}:ssm:${AWS::Region}::document/AWSQuickStarts-AWS-VPC\"\n          },\n          \"Parameters\" : {\n            \"AvailabilityZones\" : {\n              \"Fn::Join\" : [ \",\", {\n                \"Ref\" : \"AvailabilityZones\"\n              } ]\n            },\n            \"NumberOfAZs\" : \"2\",\n            \"PrivateSubnet1ACIDR\" : {\n              \"Ref\" : \"PrivateSubnet1CIDR\"\n            },\n            \"PrivateSubnet2ACIDR\" : {\n              \"Ref\" : \"PrivateSubnet2CIDR\"\n            },\n            \"PublicSubnet1CIDR\" : {\n              \"Ref\" : \"PublicSubnet1CIDR\"\n            },\n            \"PublicSubnet2CIDR\" : {\n              \"Ref\" : \"PublicSubnet2CIDR\"\n            },\n            \"VPCCIDR\" : {\n              \"Ref\" : \"VPCCIDR\"\n            },\n            \"VPCTenancy\" : {\n              \"Ref\" : \"VPCTenancy\"\n            }\n          }\n        }\n      },\n      \"RDGWStack\" : {\n        \"Type\" : \"AWS::CloudFormation::Stack\",\n        \"Properties\" : {\n          \"TemplateURL\" : {\n            \"Fn::Sub\" : \"ssm-doc://arn:${AWS::Partition}:ssm:${AWS::Region}::document/AWSQuickStarts-Microsoft-RdGateway-Existing-VPC\"\n          },\n          \"Parameters\" : {\n            \"AdminPassword\" : {\n              \"Ref\" : \"AdminPassword\"\n            },\n            \"AdminUser\" : {\n              \"Ref\" : \"AdminUser\"\n            },\n            \"KeyPairName\" : {\n              \"Ref\" : \"KeyPairName\"\n            },\n            \"NumberOfRDGWHosts\" : {\n              \"Ref\" : \"NumberOfRDGWHosts\"\n            },\n            \"PublicSubnet1ID\" : {\n              \"Fn::GetAtt\" : [ \"VPCStack\", \"Outputs.PublicSubnet1ID\" ]\n            },\n            \"PublicSubnet2ID\" : {\n              \"Fn::GetAtt\" : [ \"VPCStack\", \"Outputs.PublicSubnet2ID\" ]\n            },\n            \"QSS3BucketName\" : {\n              \"Ref\" : \"QSS3BucketName\"\n            },\n            \"QSS3KeyPrefix\" : {\n              \"Ref\" : \"QSS3KeyPrefix\"\n            },\n            \"QSS3BucketRegion\" : {\n              \"Ref\" : \"QSS3BucketRegion\"\n            },\n            \"RDGWInstanceType\" : {\n              \"Ref\" : \"RDGWInstanceType\"\n            },\n            \"RDGWCIDR\" : {\n              \"Ref\" : \"RDGWCIDR\"\n            },\n            \"VPCID\" : {\n              \"Fn::GetAtt\" : [ \"VPCStack\", \"Outputs.VPCID\" ]\n            }\n          }\n        }\n      }\n    }\n  }\n}",
  "CreatedDate": "2022-02-25T23:22:24.256Z",
  "DisplayName": null,
  "DocumentFormat": {
    "Value": "JSON"
  },
  "DocumentType": {
    "Value": "CloudFormation"
  },
  "DocumentVersion": "2",
  "Name": "AWSQuickStarts-Microsoft-RdGateway",
  "Requires": [],
  "ReviewStatus": null,
  "Status": {
    "Value": "Active"
  },
  "StatusInformation": null,
  "VersionName": "AWSQuickStarts-Microsoft-RdGateway-2022-02-25-23-05-30",
  "ResponseMetadata": {
    "RequestId": "cd3e68c7-0fc2-416e-a5b7-fadcae45de83",
    "Metadata": {},
    "ChecksumAlgorithm": 0,
    "ChecksumValidationStatus": 0
  },
  "ContentLength": 14722,
  "HttpStatusCode": 200,
  "LoggedAt": "2022-06-01T07:15:32.1107556+00:00"
}
