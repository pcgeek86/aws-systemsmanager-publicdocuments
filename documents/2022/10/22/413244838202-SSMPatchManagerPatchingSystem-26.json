{
  "AttachmentsContent": [],
  "Content": "{\n  \"outputs\": [\n    \"IdentifyRootVolume.Payload\",\n    \"PrePatchSnapshot.Payload\",\n    \"SaveComplianceReportToS3.Payload\",\n    \"RestoreFromSnapshot.Payload\",\n    \"CheckCompliance.Payload\"\n  ],\n  \"schemaVersion\": \"0.3\",\n  \"description\": \"Brings EC2 Instance into compliance with standing Baseline; rolls back root Volume on failure\",\n  \"assumeRole\": \"{{AutomationAssumeRole}}\",\n  \"parameters\": {\n    \"AutomationAssumeRole\": {\n      \"default\": \"\",\n      \"description\": \"(Optional) The ARN of the role that allows Automation to perform the actions on your behalf.\",\n      \"type\": \"String\"\n    },\n    \"SnapshotId\": {\n      \"description\": \"(Optional) The snapshot ID to use to retrieve a patch baseline snapshot.\",\n      \"type\": \"String\"\n    },\n    \"InstanceId\": {\n      \"description\": \"(Required) EC2 InstanceId to which we apply the patch-baseline\",\n      \"type\": \"String\"\n    },\n    \"LambdaAssumeRole\": {\n      \"default\": \"\",\n      \"description\": \"(Optional) The ARN of the role that allows Lambda created by Automation to perform the actions on your behalf. If not specified a transient role will be created to execute the Lambda function.\",\n      \"type\": \"String\"\n    },\n    \"NoReboot\": {\n      \"default\": \"true\",\n      \"description\": \"Do not reboot the instance before creating the image.\",\n      \"type\": \"String\"\n    },\n    \"message\": {\n      \"type\": \"String\"\n    },\n    \"ReportS3Bucket\": {\n      \"default\": \"\",\n      \"description\": \"(Optional) S3 Bucket destination for the Compliance Report generated during process\",\n      \"type\": \"String\"\n    },\n    \"environ\": {\n      \"description\": \"Environment Name.\",\n      \"type\": \"String\"\n    },\n    \"AccountId\": {\n      \"description\": \"AccountId.\",\n      \"type\": \"String\"\n    },\n    \"Region\": {\n      \"description\": \"Region.\",\n      \"type\": \"String\"\n    }\n  },\n  \"mainSteps\": [\n    {\n      \"inputs\": {\n        \"FunctionName\": \"arn:aws:lambda:{{Region}}:{{AccountId}}:function:PatchingSystem_helperFunction\",\n        \"Payload\": \"{\\\"function_arn\\\": \\\"arn:aws:lambda:us-west-2:413244838202:function:IdentifyRootVolumeLambda\\\",\\\"region_name\\\": \\\"us-west-2\\\",\\\"function_payload\\\": \\\"{\\\\\\\"InstanceId\\\\\\\": [\\\\\\\"{{InstanceId}}\\\\\\\"],\\\\\\\"AccountId\\\\\\\": \\\\\\\"{{AccountId}}\\\\\\\",\\\\\\\"Region\\\\\\\": \\\\\\\"{{Region}}\\\\\\\"}\\\"}\"\n      },\n      \"name\": \"IdentifyRootVolume\",\n      \"action\": \"aws:invokeLambdaFunction\"\n    },\n    {\n      \"inputs\": {\n        \"FunctionName\": \"arn:aws:lambda:{{Region}}:{{AccountId}}:function:PatchingSystem_helperFunction\",\n        \"Payload\": \"{\\\"function_arn\\\": \\\"arn:aws:lambda:us-west-2:413244838202:function:CreateSnapshotLambda\\\",\\\"region_name\\\": \\\"us-west-2\\\",\\\"function_payload\\\":\\\"{\\\\\\\"VolumeId64\\\\\\\": \\\\\\\"{{IdentifyRootVolume.Payload}}\\\\\\\",\\\\\\\"AccountId\\\\\\\": \\\\\\\"{{AccountId}}\\\\\\\",\\\\\\\"Region\\\\\\\": \\\\\\\"{{Region}}\\\\\\\"}\\\"}\"\n      },\n      \"name\": \"PrePatchSnapshot\",\n      \"action\": \"aws:invokeLambdaFunction\"\n    },\n    {\n      \"maxAttempts\": 1,\n      \"inputs\": {\n        \"Parameters\": {\n          \"SnapshotId\": [\n            \"{{SnapshotId}}\"\n          ],\n          \"RebootOption\": [\n            \"{{NoReboot}}\"\n          ],\n          \"Operation\": [\n            \"Install\"\n          ]\n        },\n        \"Targets\": [\n          {\n            \"Values\": [\n              \"{{environ}}\"\n            ],\n            \"Key\": \"tag:Patch Group\"\n          }\n        ],\n        \"InstanceIds\": [\n          \"{{InstanceId}}\"\n        ],\n        \"DocumentName\": \"AWS-RunPatchBaseline\"\n      },\n      \"name\": \"installPatches\",\n      \"action\": \"aws:runCommand\",\n      \"onFailure\": \"Continue\",\n      \"timeoutSeconds\": 3600\n    },\n    {\n      \"maxAttempts\": 10,\n      \"inputs\": {\n        \"FunctionName\": \"arn:aws:lambda:{{Region}}:{{AccountId}}:function:PatchingSystem_helperFunction\",\n        \"Payload\": \"{\\\"function_arn\\\": \\\"arn:aws:lambda:us-west-2:413244838202:function:SleepThruInstallationLambda\\\",\\\"region_name\\\": \\\"us-west-2\\\",\\\"function_payload\\\":\\\"{\\\\\\\"InstanceId\\\\\\\": [\\\\\\\"{{InstanceId}}\\\\\\\"],\\\\\\\"AccountId\\\\\\\": \\\\\\\"{{AccountId}}\\\\\\\",\\\\\\\"Region\\\\\\\": \\\\\\\"{{Region}}\\\\\\\"}\\\"}\"\n      },\n      \"name\": \"SleepThruInstallation\",\n      \"action\": \"aws:invokeLambdaFunction\"\n    },\n    {\n      \"inputs\": {\n        \"FunctionName\": \"arn:aws:lambda:{{Region}}:{{AccountId}}:function:PatchingSystem_helperFunction\",\n        \"Payload\": \"{\\\"function_arn\\\": \\\"arn:aws:lambda:us-west-2:413244838202:function:CheckComplianceLambda\\\",\\\"region_name\\\": \\\"us-west-2\\\",\\\"function_payload\\\":\\\"{\\\\\\\"InstanceId\\\\\\\": [\\\\\\\"{{InstanceId}}\\\\\\\"]}\\\"}\"\n      },\n      \"name\": \"CheckCompliance\",\n      \"action\": \"aws:invokeLambdaFunction\"\n    },\n    {\n      \"inputs\": {\n        \"FunctionName\": \"arn:aws:lambda:{{Region}}:{{AccountId}}:function:PatchingSystem_helperFunction\",\n        \"Payload\": \"{\\\"function_arn\\\": \\\"arn:aws:lambda:us-west-2:413244838202:function:SaveComplianceReportToS3Lambda\\\",\\\"region_name\\\": \\\"us-west-2\\\",\\\"function_payload\\\":\\\"{\\\\\\\"CheckCompliance\\\\\\\": \\\\\\\"{{CheckCompliance.Payload}}\\\\\\\", \\\\\\\"S3Bucket\\\\\\\": \\\\\\\"{{ReportS3Bucket}}\\\\\\\", \\\\\\\"ReportFileName\\\\\\\": \\\\\\\"PatchInstanceWithRollback-{{automation:EXECUTION_ID}}.json\\\\\\\"}\\\"}\"\n      },\n      \"name\": \"SaveComplianceReportToS3\",\n      \"action\": \"aws:invokeLambdaFunction\"\n    },\n    {\n      \"maxAttempts\": 1,\n      \"inputs\": {\n        \"FunctionName\": \"arn:aws:lambda:{{Region}}:{{AccountId}}:function:PatchingSystem_helperFunction\",\n        \"Payload\": \"{\\\"function_arn\\\": \\\"arn:aws:lambda:us-west-2:413244838202:function:ReportFailureLambda\\\",\\\"region_name\\\": \\\"us-west-2\\\",\\\"function_payload\\\":\\\"{\\\\\\\"CheckCompliance\\\\\\\": \\\\\\\"{{CheckCompliance.Payload}}\\\\\\\"}\\\"}\"\n      },\n      \"name\": \"ReportSuccessOrFailure\",\n      \"action\": \"aws:invokeLambdaFunction\",\n      \"onFailure\": \"step:RestoreFromSnapshot\",\n      \"nextStep\": \"DeleteSnapshot\"\n    },\n    {\n      \"inputs\": {\n        \"FunctionName\": \"arn:aws:lambda:{{Region}}:{{AccountId}}:function:PatchingSystem_helperFunction\",\n        \"Payload\": \"{\\\"function_arn\\\": \\\"arn:aws:lambda:us-west-2:413244838202:function:RestoreFromSnapshotLambda\\\",\\\"region_name\\\": \\\"us-west-2\\\",\\\"function_payload\\\":\\\"[{\\\\\\\"InstanceId\\\\\\\": \\\\\\\"{{InstanceId}}\\\\\\\", \\\\\\\"SnapshotId\\\\\\\": \\\\\\\"{{PrePatchSnapshot.Payload}}\\\\\\\", \\\\\\\"CheckCompliance\\\\\\\": \\\\\\\"{{CheckCompliance.Payload}}\\\\\\\",\\\\\\\"AccountId\\\\\\\": \\\\\\\"{{AccountId}}\\\\\\\",\\\\\\\"Region\\\\\\\": \\\\\\\"{{Region}}\\\\\\\"}]\\\"}\"\n      },\n      \"name\": \"RestoreFromSnapshot\",\n      \"action\": \"aws:invokeLambdaFunction\",\n      \"nextStep\": \"DeleteSnapshot\"\n    },\n    {\n      \"inputs\": {\n        \"FunctionName\": \"arn:aws:lambda:{{Region}}:{{AccountId}}:function:PatchingSystem_helperFunction\",\n        \"Payload\": \"{\\\"function_arn\\\": \\\"arn:aws:lambda:us-west-2:413244838202:function:DeleteSnapshotLambda\\\",\\\"region_name\\\": \\\"us-west-2\\\",\\\"function_payload\\\":\\\"{\\\\\\\"PrePatchSnapshot\\\\\\\": \\\\\\\"{{PrePatchSnapshot.Payload}}\\\\\\\",\\\\\\\"AccountId\\\\\\\": \\\\\\\"{{AccountId}}\\\\\\\",\\\\\\\"Region\\\\\\\": \\\\\\\"{{Region}}\\\\\\\"}\\\"}\"\n      },\n      \"name\": \"DeleteSnapshot\",\n      \"action\": \"aws:invokeLambdaFunction\",\n      \"isEnd\": true\n    }\n  ]\n}",
  "CreatedDate": "2020-12-18T06:49:03.783Z",
  "DisplayName": null,
  "DocumentFormat": {
    "Value": "JSON"
  },
  "DocumentType": {
    "Value": "Automation"
  },
  "DocumentVersion": "26",
  "Name": "arn:aws:ssm:us-west-2:413244838202:document/SSMPatchManagerPatchingSystem",
  "Requires": [],
  "ReviewStatus": null,
  "Status": {
    "Value": "Active"
  },
  "StatusInformation": null,
  "VersionName": null,
  "ResponseMetadata": {
    "RequestId": "a89a1b62-f41c-46fe-9834-d6e1407a91c4",
    "Metadata": {},
    "ChecksumAlgorithm": 0,
    "ChecksumValidationStatus": 0
  },
  "ContentLength": 8246,
  "HttpStatusCode": 200,
  "LoggedAt": "2022-10-22T07:20:40.998532+00:00"
}
