{
  "AttachmentsContent": [],
  "Content": "{\n  \"schemaVersion\" : \"1.0\",\n  \"description\" : \"HashiCorp Consul + VPC  Aug,28,2019 (qs-1qup6ra81)\",\n  \"templateBody\" : {\n    \"AWSTemplateFormatVersion\" : \"2010-09-09\",\n    \"Description\" : \"HashiCorp Consul + VPC  Aug,28,2019 (qs-1qup6ra81)\",\n    \"Metadata\" : {\n      \"QuickStartDocumentation\" : {\n        \"EntrypointName\" : \"Launch into a new VPC\"\n      },\n      \"LICENSE\" : \"Apache License, Version 2.0\",\n      \"AWS::CloudFormation::Interface\" : {\n        \"ParameterGroups\" : [ {\n          \"Label\" : {\n            \"default\" : \"VPC network configuration\"\n          },\n          \"Parameters\" : [ \"AvailabilityZones\", \"VPCCIDR\", \"PrivateSubnet1CIDR\", \"PrivateSubnet2CIDR\", \"PrivateSubnet3CIDR\", \"PublicSubnet1CIDR\", \"PublicSubnet2CIDR\", \"PublicSubnet3CIDR\", \"AccessCIDR\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"Consul setup\"\n          },\n          \"Parameters\" : [ \"ConsulInstanceType\", \"ConsulServerNodes\", \"ConsulClientNodes\", \"KeyPairName\", \"EnablegRPC\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"DNS and SSL configuration\"\n          },\n          \"Parameters\" : [ \"LoadBalancerFQDN\", \"HostedZoneID\", \"SSLCertificateArn\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"AWS Quick Start configuration\"\n          },\n          \"Parameters\" : [ \"QSS3BucketName\", \"QSS3KeyPrefix\" ]\n        } ],\n        \"ParameterLabels\" : {\n          \"AccessCIDR\" : {\n            \"default\" : \"Permitted IP range\"\n          },\n          \"AvailabilityZones\" : {\n            \"default\" : \"Availability Zones\"\n          },\n          \"KeyPairName\" : {\n            \"default\" : \"Key name\"\n          },\n          \"PrivateSubnet1CIDR\" : {\n            \"default\" : \"Private Subnet 1 CIDR\"\n          },\n          \"PrivateSubnet2CIDR\" : {\n            \"default\" : \"Private Subnet 2 CIDR\"\n          },\n          \"PrivateSubnet3CIDR\" : {\n            \"default\" : \"Private Subnet 3 CIDR\"\n          },\n          \"PublicSubnet1CIDR\" : {\n            \"default\" : \"Public Subnet 1 CIDR\"\n          },\n          \"PublicSubnet2CIDR\" : {\n            \"default\" : \"Public Subnet 2 CIDR\"\n          },\n          \"PublicSubnet3CIDR\" : {\n            \"default\" : \"Public Subnet 3 CIDR\"\n          },\n          \"QSS3BucketName\" : {\n            \"default\" : \"Quick Start S3 bucket name\"\n          },\n          \"QSS3KeyPrefix\" : {\n            \"default\" : \"Quick Start S3 key prefix\"\n          },\n          \"VPCCIDR\" : {\n            \"default\" : \"VPC CIDR\"\n          },\n          \"SSLCertificateArn\" : {\n            \"default\" : \"SSL certificate ARN\"\n          },\n          \"HostedZoneID\" : {\n            \"default\" : \"Route 53 hosted zone ID\"\n          },\n          \"LoadBalancerFQDN\" : {\n            \"default\" : \"Load Balancer FQDN\"\n          },\n          \"ConsulInstanceType\" : {\n            \"default\" : \"Consul cluster node instance type\"\n          },\n          \"ConsulServerNodes\" : {\n            \"default\" : \"Number of Consul server nodes\"\n          },\n          \"ConsulClientNodes\" : {\n            \"default\" : \"Number of Consul client nodes\"\n          },\n          \"EnablegRPC\" : {\n            \"default\" : \"Enable gRPC\"\n          }\n        }\n      }\n    },\n    \"Parameters\" : {\n      \"AvailabilityZones\" : {\n        \"Description\" : \"List of Availability Zones to use for the subnets in the VPC.  Note: The logical order is preserved. (3 Three Availability  ZonesAZs are used for this deployment.)\",\n        \"Type\" : \"List<AWS::EC2::AvailabilityZone::Name>\"\n      },\n      \"AccessCIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/([0-9]|[1-2][0-9]|3[0-2]))$\",\n        \"Description\" : \"The CIDR IP range that is permitted to access Consul. Note: a value of 0.0.0.0/0 will allow access from ANY ip address\",\n        \"Type\" : \"String\"\n      },\n      \"ConsulServerNodes\" : {\n        \"Type\" : \"String\",\n        \"Description\" : \"The number of Consul server nodes that will be created. You can choose 3, 5, or 7 nodes.\",\n        \"AllowedValues\" : [ \"3\", \"5\", \"7\" ],\n        \"Default\" : \"3\"\n      },\n      \"ConsulClientNodes\" : {\n        \"Type\" : \"String\",\n        \"Description\" : \"The number of Consul client nodes that will be created.\",\n        \"Default\" : \"0\"\n      },\n      \"ConsulInstanceType\" : {\n        \"Type\" : \"String\",\n        \"Default\" : \"m5.large\",\n        \"Description\" : \"The EC2 instance type for the Consul instances.\",\n        \"AllowedValues\" : [ \"t2.micro\", \"t2.small\", \"t2.medium\", \"t2.large\", \"m5.large\", \"m5.xlarge\", \"m4.xlarge\", \"m4.large\", \"m4.xlarge\", \"m3.medium\", \"m3.large\", \"m3.xlarge\", \"m3.2xlarge\", \"c4.large\", \"c4.xlarge\", \"c4.2xlarge\", \"c4.4xlarge\", \"c4.8xlarge\", \"c3.large\", \"c3.xlarge\", \"c3.2xlarge\", \"c3.4xlarge\", \"c3.8xlarge\", \"r3.large\", \"r3.xlarge\", \"r3.2xlarge\", \"r3.4xlarge\", \"r3.8xlarge\", \"i2.xlarge\", \"i2.2xlarge\", \"i2.4xlarge\", \"i2.8xlarge\" ],\n        \"ConstraintDescription\" : \"Choose an instance type. m3.medium or larger recommended.\"\n      },\n      \"KeyPairName\" : {\n        \"Description\" : \"Public/private key pairs allow you to securely connect to your instance after it launches\",\n        \"Type\" : \"AWS::EC2::KeyPair::KeyName\"\n      },\n      \"PrivateSubnet1CIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/([0-9]|[1-2][0-9]|3[0-2]))$\",\n        \"Default\" : \"10.0.0.0/19\",\n        \"Description\" : \"CIDR block for private subnet 1 located in Availability Zone 1.\",\n        \"Type\" : \"String\"\n      },\n      \"PrivateSubnet2CIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/([0-9]|[1-2][0-9]|3[0-2]))$\",\n        \"Default\" : \"10.0.32.0/19\",\n        \"Description\" : \"CIDR block for private subnet 2 located in Availability Zone 2.\",\n        \"Type\" : \"String\"\n      },\n      \"PrivateSubnet3CIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/([0-9]|[1-2][0-9]|3[0-2]))$\",\n        \"Default\" : \"10.0.64.0/19\",\n        \"Description\" : \"CIDR block for private subnet 3 located in Availability Zone 3.\",\n        \"Type\" : \"String\"\n      },\n      \"PublicSubnet1CIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/([0-9]|[1-2][0-9]|3[0-2]))$\",\n        \"Default\" : \"10.0.128.0/20\",\n        \"Description\" : \"CIDR block for the public DMZ subnet 1 located in Availability Zone 1\",\n        \"Type\" : \"String\"\n      },\n      \"PublicSubnet2CIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/([0-9]|[1-2][0-9]|3[0-2]))$\",\n        \"Default\" : \"10.0.144.0/20\",\n        \"Description\" : \"CIDR block for the public DMZ subnet 2 located in Availability Zone 2\",\n        \"Type\" : \"String\"\n      },\n      \"PublicSubnet3CIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/([0-9]|[1-2][0-9]|3[0-2]))$\",\n        \"Default\" : \"10.0.160.0/20\",\n        \"Description\" : \"CIDR block for the public DMZ subnet 3 located in Availability Zone 3\",\n        \"Type\" : \"String\"\n      },\n      \"QSS3BucketName\" : {\n        \"AllowedPattern\" : \"^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$\",\n        \"ConstraintDescription\" : \"Quick Start bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).\",\n        \"Default\" : \"aws-quickstart\",\n        \"Description\" : \"S3 bucket name for the Quick Start assets. Quick Start bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-).\",\n        \"Type\" : \"String\"\n      },\n      \"QSS3KeyPrefix\" : {\n        \"AllowedPattern\" : \"^[0-9a-zA-Z-/]*$\",\n        \"ConstraintDescription\" : \"Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).\",\n        \"Default\" : \"quickstart-hashicorp-consul/\",\n        \"Description\" : \"S3 key prefix for the Quick Start assets. Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/).\",\n        \"Type\" : \"String\"\n      },\n      \"VPCCIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/([0-9]|[1-2][0-9]|3[0-2]))$\",\n        \"Default\" : \"10.0.0.0/16\",\n        \"Description\" : \"CIDR block for the VPC\",\n        \"Type\" : \"String\"\n      },\n      \"SSLCertificateArn\" : {\n        \"Description\" : \"The Amazon resource Name(ARN) of the SSL certificate to use for the load balancer. Use 'SSLCertificateArn' if you are not using 'LoadBalancerFQDN' and 'HostedZoneID'.\",\n        \"Type\" : \"String\",\n        \"Default\" : \"\"\n      },\n      \"HostedZoneID\" : {\n        \"Description\" : \"Route 53 Hosted Zone ID of the domain name. Used in conjunction with 'LoadBalancerFQDN'.\",\n        \"Type\" : \"String\",\n        \"MaxLength\" : 32,\n        \"Default\" : \"\"\n      },\n      \"LoadBalancerFQDN\" : {\n        \"Description\" : \"The fully qualified domain name for the load balancer. Use with 'HostedZoneID' if you are NOT using SSL.\",\n        \"Type\" : \"String\",\n        \"Default\" : \"\"\n      },\n      \"EnablegRPC\" : {\n        \"Description\" : \"Enable gRPC on the Consul server cluster.\",\n        \"Type\" : \"String\",\n        \"Default\" : \"false\",\n        \"AllowedValues\" : [ \"true\", \"false\" ]\n      }\n    },\n    \"Conditions\" : {\n      \"GovCloudCondition\" : [ \"AWS::Region\", \"us-gov-west-1\" ],\n      \"SetupRoute53\" : [ [ [ \"HostedZoneID\", \"\" ] ], [ [ \"LoadBalancerFQDN\", \"\" ] ] ]\n    },\n    \"Resources\" : {\n      \"VPCStack\" : {\n        \"Type\" : \"AWS::CloudFormation::Stack\",\n        \"Properties\" : {\n          \"TemplateURL\" : \"https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}submodules/quickstart-aws-vpc/templates/aws-vpc.template.yaml\",\n          \"Parameters\" : {\n            \"AvailabilityZones\" : [ \",\", \"AvailabilityZones\" ],\n            \"NumberOfAZs\" : \"3\",\n            \"PrivateSubnet1ACIDR\" : \"PrivateSubnet1CIDR\",\n            \"PrivateSubnet2ACIDR\" : \"PrivateSubnet2CIDR\",\n            \"PrivateSubnet3ACIDR\" : \"PrivateSubnet3CIDR\",\n            \"PublicSubnet1CIDR\" : \"PublicSubnet1CIDR\",\n            \"PublicSubnet2CIDR\" : \"PublicSubnet2CIDR\",\n            \"PublicSubnet3CIDR\" : \"PublicSubnet3CIDR\",\n            \"VPCCIDR\" : \"VPCCIDR\"\n          }\n        }\n      },\n      \"BastionStack\" : {\n        \"Type\" : \"AWS::CloudFormation::Stack\",\n        \"Properties\" : {\n          \"TemplateURL\" : \"https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}submodules/quickstart-linux-bastion/templates/linux-bastion.template\",\n          \"Parameters\" : {\n            \"BastionAMIOS\" : \"Ubuntu-Server-20.04-LTS-HVM\",\n            \"BastionInstanceType\" : \"t3.medium\",\n            \"KeyPairName\" : \"KeyPairName\",\n            \"PublicSubnet1ID\" : [ \"VPCStack\", \"Outputs.PublicSubnet1ID\" ],\n            \"PublicSubnet2ID\" : [ \"VPCStack\", \"Outputs.PublicSubnet2ID\" ],\n            \"QSS3BucketName\" : \"QSS3BucketName\",\n            \"QSS3KeyPrefix\" : \"${QSS3KeyPrefix}submodules/quickstart-linux-bastion/\",\n            \"RemoteAccessCIDR\" : \"AccessCIDR\",\n            \"VPCID\" : [ \"VPCStack\", \"Outputs.VPCID\" ]\n          }\n        }\n      },\n      \"HashiCorpConsulStack\" : {\n        \"Type\" : \"AWS::CloudFormation::Stack\",\n        \"Properties\" : {\n          \"TemplateURL\" : \"https://${QSS3BucketName}.s3.amazonaws.com/${QSS3KeyPrefix}templates/quickstart-hashicorp-consul.template.yaml\",\n          \"Parameters\" : {\n            \"BastionSecurityGroupID\" : [ \"BastionStack\", \"Outputs.BastionSecurityGroupID\" ],\n            \"PrivateSubnet1ID\" : [ \"VPCStack\", \"Outputs.PrivateSubnet1AID\" ],\n            \"PrivateSubnet2ID\" : [ \"VPCStack\", \"Outputs.PrivateSubnet2AID\" ],\n            \"PrivateSubnet3ID\" : [ \"VPCStack\", \"Outputs.PrivateSubnet3AID\" ],\n            \"PublicSubnet1ID\" : [ \"VPCStack\", \"Outputs.PublicSubnet1ID\" ],\n            \"PublicSubnet2ID\" : [ \"VPCStack\", \"Outputs.PublicSubnet2ID\" ],\n            \"PublicSubnet3ID\" : [ \"VPCStack\", \"Outputs.PublicSubnet3ID\" ],\n            \"VPCID\" : [ \"VPCStack\", \"Outputs.VPCID\" ],\n            \"VPCCIDR\" : \"VPCCIDR\",\n            \"ConsulServerNodes\" : \"ConsulServerNodes\",\n            \"ConsulClientNodes\" : \"ConsulClientNodes\",\n            \"ConsulInstanceType\" : \"ConsulInstanceType\",\n            \"EnablegRPC\" : \"EnablegRPC\",\n            \"KeyPair\" : \"KeyPairName\",\n            \"ConsulEc2RetryTagKey\" : \"quickstart-consul-cluster\",\n            \"ConsulEc2RetryTagValue\" : \"consul-member-node\",\n            \"QSS3BucketName\" : \"QSS3BucketName\",\n            \"QSS3KeyPrefix\" : \"QSS3KeyPrefix\",\n            \"SSLCertificateArn\" : \"SSLCertificateArn\",\n            \"HostedZoneID\" : \"HostedZoneID\",\n            \"LoadBalancerFQDN\" : \"LoadBalancerFQDN\"\n          }\n        }\n      }\n    },\n    \"Outputs\" : {\n      \"ConsulEc2RetryTagKey\" : {\n        \"Value\" : \"HashiCorpConsulStack.Outputs.ConsulEc2RetryTagKey\",\n        \"Description\" : \"The EC2 instance tag key to filter on when joining to other Consul nodes.\"\n      },\n      \"ConsulEc2RetryTagValue\" : {\n        \"Value\" : \"HashiCorpConsulStack.Outputs.ConsulEc2RetryTagValue\",\n        \"Description\" : \"The EC2 instance tag value to filter on when joining to other Consul nodes.\"\n      },\n      \"ConsulServerELB\" : {\n        \"Description\" : \"The public URL of your Consul Load Balancer. Create a CNAME record pointing at this Load Balancer.\",\n        \"Value\" : \"HashiCorpConsulStack.Outputs.ConsulServerELB\"\n      },\n      \"ConsulServerFQDN\" : {\n        \"Condition\" : \"SetupRoute53\",\n        \"Description\" : \"The public CNAME pointing to your Consul Load Balancer.\",\n        \"Value\" : \"HashiCorpConsulStack.Outputs.ConsulServerFQDN\"\n      }\n    }\n  }\n}",
  "CreatedDate": "2021-06-29T02:14:09.733Z",
  "DisplayName": null,
  "DocumentFormat": {
    "Value": "JSON"
  },
  "DocumentType": {
    "Value": "CloudFormation"
  },
  "DocumentVersion": "1",
  "Name": "AWSQuickStarts-HashicorpConsul",
  "Requires": [],
  "ReviewStatus": null,
  "Status": {
    "Value": "Active"
  },
  "StatusInformation": null,
  "VersionName": null,
  "ResponseMetadata": {
    "RequestId": "af5d1d48-d850-4fb0-8bd7-72c4763973b2",
    "Metadata": {},
    "ChecksumAlgorithm": 0,
    "ChecksumValidationStatus": 0
  },
  "ContentLength": 15369,
  "HttpStatusCode": 200,
  "LoggedAt": "2022-11-15T07:13:50.5983889+00:00"
}
