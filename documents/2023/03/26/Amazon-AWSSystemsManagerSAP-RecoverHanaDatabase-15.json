{
  "AttachmentsContent": [],
  "Content": "{\n\t\"description\": \"Recover the specified HANA database.\",\n\t\"schemaVersion\": \"2.2\",\n\t\"parameters\": {\n\t\t\"FilePath\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedPattern\": \"^/hana/shared/aws-backint-agent/awsbackup/StorageId.json$\",\n\t\t\t\"maxChars\": 100\n\t\t},\n\t\t\"HANASecretId\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"default\": \"''\",\n\t\t\t\"allowedPattern\": \"^[a-zA-Z0-9\\\"\\\\'\\\\[\\\\]\\\\{\\\\}\\\\/\\\\-_:+=\\\\.@]*$\",\n\t\t\t\"maxChars\": 128\n\t\t},\n\t\t\"HANASecretRegion\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedPattern\": \"^[a-z0-9\\\\-]*$\",\n\t\t\t\"maxChars\": 30\n\t\t},\n\t\t\"HANASID\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"default\": \"None\",\n\t\t\t\"allowedPattern\": \"[A-Za-z0-9]{3}\"\n\t\t},\n\t\t\"HANAInstanceNum\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"default\": \"None\",\n\t\t\t\"allowedPattern\": \"^[0-9]{2}$\"\n\t\t},\n\t\t\"HANADatabaseName\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedPattern\": \"^[a-zA-Z0-9_\\\\-\\\\/]*$\",\n\t\t\t\"maxChars\": 150\n\t\t},\n\t\t\"RestoreType\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedValues\": [\n\t\t\t\t\"FULL_DATA_BACKUP_RECOVERY\",\n\t\t\t\t\"POINT_IN_TIME_RECOVERY\",\n\t\t\t\t\"LOG_POSITION_RECOVERY\",\n\t\t\t\t\"MOST_RECENT_TIME_RECOVERY\"\n\t\t\t]\n\t\t},\n\t\t\"HanaBackupId\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedPattern\": \"^None|[0-9]{13}$\"\n\t\t},\n\t\t\"BackupPrefix\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedPattern\": \"(^$|^[a-zA-Z0-9_]{1,32}$)\"\n\t\t},\n\t\t\"DBSystemCopy\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedValues\": [\n\t\t\t\t\"True\",\n\t\t\t\t\"False\"\n\t\t\t]\n\t\t},\n\t\t\"SourceSystemId\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedPattern\": \"None|[A-Za-z0-9]{3}\"\n\t\t},\n\t\t\"SourceDatabaseName\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedPattern\": \"^None|[a-zA-Z0-9_\\\\-\\\\/]*$\"\n\t\t},\n\t\t\"CatalogIdRead\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedPattern\": \"^[a-zA-Z0-9!@#$%^&*=?+-/]*$\",\n\t\t\t\"maxChars\": 6148\n\t\t},\n\t\t\"LogIdRead\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedPattern\": \"^[a-zA-Z0-9!@#$%^&*=?+-/]*$\",\n\t\t\t\"maxChars\": 6148\n\t\t},\n\t\t\"RestoreTimestamp\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedPattern\": \"^None|[0-9]{10}$\"\n\t\t},\n\t\t\"CatalogRestoreOptions\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedValues\": [\n\t\t\t\t\"NO_CATALOG\",\n\t\t\t\t\"LATEST_CATALOG_FROM_AWS_BACKUP\",\n\t\t\t\t\"CLOSEST_CATALOG_FROM_AWS_BACKUP\",\n\t\t\t\t\"CATALOG_FROM_LOCAL_PATH\"\n\t\t\t]\n\t\t},\n\t\t\"LocalCatalogPath\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedPattern\": \"^None|[A-Za-z0-9-_./]*$\"\n\t\t},\n\t\t\"LogBackupRestoreOption\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedValues\": [\n\t\t\t\t\"LOG_ONLY_FROM_AWS_BACKUP\",\n\t\t\t\t\"LOG_FROM_BOTH_AWS_BACKUP_AND_LOCAL\",\n\t\t\t\t\"None\"\n\t\t\t]\n\t\t},\n\t\t\"LocalLogBackupPaths\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedPattern\": \"^None|^[A-Za-z0-9-_.,/ ]*$\"\n\t\t},\n\t\t\"InitializeLogArea\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedValues\": [\n\t\t\t\t\"True\",\n\t\t\t\t\"False\"\n\t\t\t]\n\t\t},\n\t\t\"UseDeltaBackups\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedValues\": [\n\t\t\t\t\"True\",\n\t\t\t\t\"False\"\n\t\t\t]\n\t\t},\n\t\t\"LogPositionId\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedPattern\": \"^None|[A-Za-z0-9_/,]*$\"\n\t\t},\n\t\t\"LogVolumeId\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedPattern\": \"^None|[A-Za-z0-9_/,]*$\"\n\t\t},\n\t\t\"RestoreIdRead\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"allowedPattern\": \"^[a-zA-Z0-9!@#$%^&*=?+-/]*$\",\n\t\t\t\"maxChars\": 6148\n\t\t},\n\t\t\"Debug\": {\n\t\t\t\"type\": \"String\",\n\t\t\t\"default\": \"False\",\n\t\t\t\"allowedValues\": [\n\t\t\t\t\"True\",\n\t\t\t\t\"False\"\n\t\t\t]\n\t\t}\n\t},\n\t\"mainSteps\": [\n\t\t{\n\t\t\t\"name\": \"InstallPackage\",\n\t\t\t\"action\": \"aws:runDocument\",\n\t\t\t\"inputs\": {\n\t\t\t\t\"documentType\": \"SSMDocument\",\n\t\t\t\t\"documentPath\": \"AWS-ConfigureAWSPackage\",\n\t\t\t\t\"documentParameters\": {\n\t\t\t\t\t\"name\": \"arn:aws:ssm:us-west-2:318514306794:document/AWSSystemsManagerSAP-Support\",\n\t\t\t\t\t\"action\": \"Install\",\n\t\t\t\t\t\"installationType\": \"Uninstall and reinstall\"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"name\": \"InstallPackageAgain\",\n\t\t\t\"action\": \"aws:runDocument\",\n\t\t\t\"inputs\": {\n\t\t\t\t\"documentType\": \"SSMDocument\",\n\t\t\t\t\"documentPath\": \"AWS-ConfigureAWSPackage\",\n\t\t\t\t\"documentParameters\": {\n\t\t\t\t\t\"name\": \"arn:aws:ssm:us-west-2:318514306794:document/AWSSystemsManagerSAP-Support\",\n\t\t\t\t\t\"action\": \"Install\",\n\t\t\t\t\t\"installationType\": \"Uninstall and reinstall\"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"name\": \"PerformAction\",\n\t\t\t\"action\": \"aws:runShellScript\",\n\t\t\t\"inputs\": {\n\t\t\t\t\"RunCommand\": [\n\t\t\t\t\t\"# Timestamp: 1679375063735\",\n\t\t\t\t\t\"mkdir -p /usr/bin/ssm-sap/logs\",\n\t\t\t\t\t\"cd /usr/bin/ssm-sap/logs\",\n\t\t\t\t\t\"export PYTHONPATH=$PYTHONPATH:/usr/bin/ssm-sap/scripts\",\n\t\t\t\t\t\"if [ $(which python3 3>/dev/null) ]; then\",\n\t\t\t\t\t\"   PYTHON_BIN=$(which python3)\",\n\t\t\t\t\t\"elif [ $(which python 3>/dev/null) ]; then\",\n\t\t\t\t\t\"   PYTHON_BIN=$(which python)\",\n\t\t\t\t\t\"else\",\n\t\t\t\t\t\"   exit 1\",\n\t\t\t\t\t\"fi\",\n\t\t\t\t\t\"if [[ \\\"{{Debug}}\\\" == \\\"True\\\" ]]; then\",\n\t\t\t\t\t\"   DEBUGMODE='--debug'\",\n\t\t\t\t\t\"else\",\n\t\t\t\t\t\"   DEBUGMODE=''\",\n\t\t\t\t\t\"fi\",\n\t\t\t\t\t\"touch ~/.bashrc && source ~/.bashrc\",\n\t\t\t\t\t\"if [[ \\\":$PYTHONPATH:\\\" != *\\\":/usr/bin/ssm-sap/scripts/dependencies\\\"* ]]; then\",\n\t\t\t\t\t\"   sed -i 's#://usr/bin/ssm-sap/scripts/dependencies##' ~/.bashrc\",\n\t\t\t\t\t\"   echo export PYTHONPATH='${PYTHONPATH}:/usr/bin/ssm-sap/scripts/dependencies' >> ~/.bashrc\",\n\t\t\t\t\t\"   source ~/.bashrc\",\n\t\t\t\t\t\"fi\",\n\t\t\t\t\t\"declare -A params\",\n\t\t\t\t\t\"count=0\",\n\t\t\t\t\t\"dict=\\\"{ \\\"\",\n\t\t\t\t\t\"params[FilePath]='{{FilePath}}'\",\n\t\t\t\t\t\"params[HANASecretId]='{{HANASecretId}}'\",\n\t\t\t\t\t\"params[HANASecretRegion]='{{HANASecretRegion}}'\",\n\t\t\t\t\t\"params[HANASID]='{{HANASID}}'\",\n\t\t\t\t\t\"params[HANAInstanceNum]='{{HANAInstanceNum}}'\",\n\t\t\t\t\t\"params[HANADatabaseName]='{{HANADatabaseName}}'\",\n\t\t\t\t\t\"params[RestoreType]='{{RestoreType}}'\",\n\t\t\t\t\t\"params[HanaBackupId]='{{HanaBackupId}}'\",\n\t\t\t\t\t\"params[BackupPrefix]='{{BackupPrefix}}'\",\n\t\t\t\t\t\"params[DBSystemCopy]='{{DBSystemCopy}}'\",\n\t\t\t\t\t\"params[SourceSystemId]='{{SourceSystemId}}'\",\n\t\t\t\t\t\"params[SourceDatabaseName]='{{SourceDatabaseName}}'\",\n\t\t\t\t\t\"params[CatalogIdRead]='{{CatalogIdRead}}'\",\n\t\t\t\t\t\"params[LogIdRead]='{{LogIdRead}}'\",\n\t\t\t\t\t\"params[RestoreTimestamp]='{{RestoreTimestamp}}'\",\n\t\t\t\t\t\"params[CatalogRestoreOptions]='{{CatalogRestoreOptions}}'\",\n\t\t\t\t\t\"params[LocalCatalogPath]='{{LocalCatalogPath}}'\",\n\t\t\t\t\t\"params[LogBackupRestoreOption]='{{LogBackupRestoreOption}}'\",\n\t\t\t\t\t\"params[LocalLogBackupPaths]='{{LocalLogBackupPaths}}'\",\n\t\t\t\t\t\"params[InitializeLogArea]='{{InitializeLogArea}}'\",\n\t\t\t\t\t\"params[UseDeltaBackups]='{{UseDeltaBackups}}'\",\n\t\t\t\t\t\"params[LogPositionId]='{{LogPositionId}}'\",\n\t\t\t\t\t\"params[LogVolumeId]='{{LogVolumeId}}'\",\n\t\t\t\t\t\"params[RestoreIdRead]='{{RestoreIdRead}}'\",\n\t\t\t\t\t\"params[Debug]='{{Debug}}'\",\n\t\t\t\t\t\"len=$(expr ${#params[@]} - 1)\",\n\t\t\t\t\t\"for keys in \\\"${!params[@]}\\\"; do\",\n\t\t\t\t\t\"    if [ ${count} -lt ${len} ]; then\",\n\t\t\t\t\t\"        dict=$(printf '%s ' \\\"$dict\\\" \\\"\\\\\\\"$keys\\\\\\\":\\\" \\\"\\\\\\\"${params[$keys]}\\\\\\\", \\\")\",\n\t\t\t\t\t\"    else\",\n\t\t\t\t\t\"        dict=$(printf '%s ' \\\"$dict\\\" \\\"\\\\\\\"$keys\\\\\\\":\\\" \\\"\\\\\\\"${params[$keys]}\\\\\\\"\\\")\",\n\t\t\t\t\t\"    fi\",\n\t\t\t\t\t\"    ((count++))\",\n\t\t\t\t\t\"done\",\n\t\t\t\t\t\"dict=\\\"$(echo -n ${dict}) }\\\"\",\n\t\t\t\t\t\"$PYTHON_BIN /usr/bin/ssm-sap/scripts/idRenewal/id_renewal.py --dbName '{{HANADatabaseName}}' --sourceDbName '{{SourceDatabaseName}}' --sid '{{HANASID}}' --filePath '{{FilePath}}' --restoreIdRead '{{RestoreIdRead}}' --catalogIdRead '{{CatalogIdRead}}' --txIdRead '{{LogIdRead}}' $DEBUGMODE --noEcho\",\n\t\t\t\t\t\"$PYTHON_BIN /usr/bin/ssm-sap/scripts/restore/HanaRestore.py \\\"${dict}\\\" $DEBUGMODE\"\n\t\t\t\t],\n\t\t\t\t\"TimeoutSeconds\": \"14400\"\n\t\t\t}\n\t\t}\n\t]\n}",
  "CreatedDate": "2023-03-23T15:13:50.938Z",
  "DisplayName": null,
  "DocumentFormat": {
    "Value": "JSON"
  },
  "DocumentType": {
    "Value": "Command"
  },
  "DocumentVersion": "15",
  "Name": "AWSSystemsManagerSAP-RecoverHanaDatabase",
  "Requires": [],
  "ReviewStatus": null,
  "Status": {
    "Value": "Active"
  },
  "StatusInformation": null,
  "VersionName": null,
  "ResponseMetadata": {
    "RequestId": "940e0c67-ceeb-4d45-bda8-1eb1f7cdd405",
    "Metadata": {},
    "ChecksumAlgorithm": 0,
    "ChecksumValidationStatus": 0
  },
  "ContentLength": 8843,
  "HttpStatusCode": 200,
  "LoggedAt": "2023-03-26T07:11:41.1253151+00:00"
}
