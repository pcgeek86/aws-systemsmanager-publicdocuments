{
  "AttachmentsContent": [],
  "Content": "{\n  \"schemaVersion\" : \"1.0\",\n  \"description\" : \"This template creates a VPC infrastructure for a multi-AZ, multi-tier deployment of a Windows based Application infrastructure. It installs 2 Windows Active Directory Domain Controllers into private subnets in separate Availability Zones inside a VPC, as well as Remote Desktop Gateway instances and managed NAT gateways into the public subnet for each Availability Zone. The default Domain Administrator password will be the one retrieved from the instance.  For adding members to the domain, ensure that they are launched into the domain member security group created by this template and then configure them to use the AD instances fixed private IP addresses as the DNS server. **WARNING** This template creates Amazon EC2 Windows instance and related resources. You will be billed for the AWS resources used if you create a stack from this template. (qs-1rtnidq09)\",\n  \"templateBody\" : {\n    \"AWSTemplateFormatVersion\" : \"2010-09-09\",\n    \"Description\" : \"This template creates a VPC infrastructure for a multi-AZ, multi-tier deployment of a Windows based Application infrastructure. It installs 2 Windows Active Directory Domain Controllers into private subnets in separate Availability Zones inside a VPC, as well as Remote Desktop Gateway instances and managed NAT gateways into the public subnet for each Availability Zone. The default Domain Administrator password will be the one retrieved from the instance.  For adding members to the domain, ensure that they are launched into the domain member security group created by this template and then configure them to use the AD instances fixed private IP addresses as the DNS server. **WARNING** This template creates Amazon EC2 Windows instance and related resources. You will be billed for the AWS resources used if you create a stack from this template. (qs-1rtnidq09)\",\n    \"Metadata\" : {\n      \"cfn-lint\" : {\n        \"config\" : {\n          \"ignore_checks\" : [ \"W9006\", \"W9901\", \"E9902\" ]\n        }\n      },\n      \"QuickStartDocumentation\" : {\n        \"EntrypointName\" : \"Parameters for deploying self-managed AD into a new VPC\",\n        \"Order\" : \"1\"\n      },\n      \"AWS::CloudFormation::Interface\" : {\n        \"ParameterGroups\" : [ {\n          \"Label\" : {\n            \"default\" : \"Network configuration\"\n          },\n          \"Parameters\" : [ \"AvailabilityZones\", \"NumberOfAZs\", \"VPCCIDR\", \"DHCPOptionSet\", \"PrivateSubnet1CIDR\", \"PrivateSubnet2CIDR\", \"PrivateSubnet3CIDR\", \"PublicSubnet1CIDR\", \"PublicSubnet2CIDR\", \"PublicSubnet3CIDR\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"Amazon EC2 configuration\"\n          },\n          \"Parameters\" : [ \"ADServer1InstanceType\", \"ADServer1NetBIOSName\", \"ADServer1PrivateIP\", \"ADServer2InstanceType\", \"ADServer2NetBIOSName\", \"ADServer2PrivateIP\", \"ADServerEnableAdvancedAudtingandMetrics\", \"DataDriveSizeGiB\", \"KeyPairName\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"Microsoft Active Directory Domain Services configuration\"\n          },\n          \"Parameters\" : [ \"DomainAdminUser\", \"DomainAdminPassword\", \"DomainDNSName\", \"DomainNetBIOSName\", \"CreateDefaultOUs\", \"TombstoneLifetime\", \"DeletedObjectLifetime\", \"SetupAppInsightsMonitoring\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"Microsoft Active Directory Certificate Services configuration\"\n          },\n          \"Parameters\" : [ \"PKI\", \"CaServerInstanceType\", \"CaDataDriveSizeGiB\", \"OrCaServerNetBIOSName\", \"EntCaServerNetBIOSName\", \"CaKeyLength\", \"CaHashAlgorithm\", \"OrCaValidityPeriodUnits\", \"CaValidityPeriodUnits\", \"UseS3ForCRL\", \"S3CRLBucketName\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"Microsoft Remote Desktop Gateway configuration\"\n          },\n          \"Parameters\" : [ \"NumberOfRDGWHosts\", \"RDGWInstanceType\", \"RDGWCIDR\" ]\n        }, {\n          \"Label\" : {\n            \"default\" : \"AWS Quick Start configuration\"\n          },\n          \"Parameters\" : [ \"QSS3BucketName\", \"QSS3BucketRegion\", \"QSS3KeyPrefix\" ]\n        } ],\n        \"ParameterLabels\" : {\n          \"ADServer1InstanceType\" : {\n            \"default\" : \"Domain Controller 1 Instance Type\"\n          },\n          \"ADServer1NetBIOSName\" : {\n            \"default\" : \"Domain Controller 1 NetBIOS Name\"\n          },\n          \"ADServer1PrivateIP\" : {\n            \"default\" : \"Domain Controller 1 Private IP Address\"\n          },\n          \"ADServer2InstanceType\" : {\n            \"default\" : \"Domain Controller 2 Instance Type\"\n          },\n          \"ADServer2NetBIOSName\" : {\n            \"default\" : \"Domain Controller 2 NetBIOS Name\"\n          },\n          \"ADServer2PrivateIP\" : {\n            \"default\" : \"Domain Controller 2 Private IP Address\"\n          },\n          \"ADServerEnableAdvancedAudtingandMetrics\" : {\n            \"default\" : \"Advanced Auditing and Metrics\"\n          },\n          \"AvailabilityZones\" : {\n            \"default\" : \"Availability Zones\"\n          },\n          \"CaDataDriveSizeGiB\" : {\n            \"default\" : \"CA Data Drive Size\"\n          },\n          \"CaHashAlgorithm\" : {\n            \"default\" : \"CA Hash Algorithm\"\n          },\n          \"CaKeyLength\" : {\n            \"default\" : \"CA Key Length\"\n          },\n          \"CaServerInstanceType\" : {\n            \"default\" : \"CA Instance Type\"\n          },\n          \"CaValidityPeriodUnits\" : {\n            \"default\" : \"Enterprise Root or Subordinate CA Certificate Validity Period in Years\"\n          },\n          \"CreateDefaultOUs\" : {\n            \"default\" : \"Create Default OUs\"\n          },\n          \"DHCPOptionSet\" : {\n            \"default\" : \"Create a DHCP Options set\"\n          },\n          \"DataDriveSizeGiB\" : {\n            \"default\" : \"SYSVOL and NTDS and Data Drive Size\"\n          },\n          \"DeletedObjectLifetime\" : {\n            \"default\" : \"Set new Deleted Objects Lifetime\"\n          },\n          \"DomainAdminPassword\" : {\n            \"default\" : \"Alternate Domain Admin Password\"\n          },\n          \"DomainAdminUser\" : {\n            \"default\" : \"Alternate Domain Admin User Name\"\n          },\n          \"DomainDNSName\" : {\n            \"default\" : \"Domain DNS Name\"\n          },\n          \"DomainNetBIOSName\" : {\n            \"default\" : \"Domain NetBIOS Name\"\n          },\n          \"EntCaServerNetBIOSName\" : {\n            \"default\" : \"Enterprise Root or Subordinate CA NetBIOS Name\"\n          },\n          \"KeyPairName\" : {\n            \"default\" : \"Key Pair Name\"\n          },\n          \"NumberOfAZs\" : {\n            \"default\" : \"Number of Availability Zones\"\n          },\n          \"NumberOfRDGWHosts\" : {\n            \"default\" : \"Number of RDGW Hosts\"\n          },\n          \"OrCaServerNetBIOSName\" : {\n            \"default\" : \"Offline Root CA NetBIOS Name (Only Used For Two Tier PKI)\"\n          },\n          \"OrCaValidityPeriodUnits\" : {\n            \"default\" : \"Offline Root CA Certificate Validity Period in Years (Only Used For Two Tier PKI)\"\n          },\n          \"PKI\" : {\n            \"default\" : \"Deploy PKI Infrastructure\"\n          },\n          \"PrivateSubnet1CIDR\" : {\n            \"default\" : \"Private Subnet 1 CIDR\"\n          },\n          \"PrivateSubnet2CIDR\" : {\n            \"default\" : \"Private Subnet 2 CIDR\"\n          },\n          \"PrivateSubnet3CIDR\" : {\n            \"default\" : \"(Optional) Private Subnet 3 CIDR\"\n          },\n          \"PublicSubnet1CIDR\" : {\n            \"default\" : \"Public Subnet 1 CIDR\"\n          },\n          \"PublicSubnet2CIDR\" : {\n            \"default\" : \"Public Subnet 2 CIDR\"\n          },\n          \"PublicSubnet3CIDR\" : {\n            \"default\" : \"(Optional) Public Subnet 3 CIDR\"\n          },\n          \"QSS3BucketName\" : {\n            \"default\" : \"Quick Start S3 Bucket Name\"\n          },\n          \"QSS3BucketRegion\" : {\n            \"default\" : \"Quick Start S3 Bucket Region\"\n          },\n          \"QSS3KeyPrefix\" : {\n            \"default\" : \"Quick Start S3 Key Prefix\"\n          },\n          \"RDGWCIDR\" : {\n            \"default\" : \"Allowed Remote Desktop Gateway External Access CIDR\"\n          },\n          \"RDGWInstanceType\" : {\n            \"default\" : \"Remote Desktop Gateway Instance Type\"\n          },\n          \"SetupAppInsightsMonitoring\" : {\n            \"default\" : \"Setup Application Insights monitoring\"\n          },\n          \"S3CRLBucketName\" : {\n            \"default\" : \"CA CRL S3 Bucket Name\"\n          },\n          \"TombstoneLifetime\" : {\n            \"default\" : \"Set new Tombstone Lifetime\"\n          },\n          \"UseS3ForCRL\" : {\n            \"default\" : \"Use S3 for CA CRL Location\"\n          },\n          \"VPCCIDR\" : {\n            \"default\" : \"VPC CIDR\"\n          }\n        }\n      }\n    },\n    \"Parameters\" : {\n      \"ADServer1InstanceType\" : {\n        \"AllowedValues\" : [ \"t3.medium\", \"t3.large\", \"t3.xlarge\", \"t3.2xlarge\", \"m5.large\", \"m5.xlarge\", \"m5.2xlarge\", \"m5.4xlarge\" ],\n        \"Default\" : \"m5.large\",\n        \"Description\" : \"Amazon EC2 instance type for the first Active Directory Domain Controller instance\",\n        \"Type\" : \"String\"\n      },\n      \"ADServer1NetBIOSName\" : {\n        \"AllowedPattern\" : \"[a-zA-Z0-9\\\\-]+\",\n        \"Default\" : \"DC1\",\n        \"Description\" : \"NetBIOS name of the first Active Directory Domain Controller (up to 15 characters)\",\n        \"MaxLength\" : \"15\",\n        \"MinLength\" : \"1\",\n        \"Type\" : \"String\"\n      },\n      \"ADServer1PrivateIP\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$\",\n        \"Default\" : \"10.0.0.10\",\n        \"Description\" : \"Fixed private IP for the first Active Directory Domain Controller located in Availability Zone 1\",\n        \"Type\" : \"String\"\n      },\n      \"ADServer2InstanceType\" : {\n        \"AllowedValues\" : [ \"t3.medium\", \"t3.large\", \"t3.xlarge\", \"t3.2xlarge\", \"m5.large\", \"m5.xlarge\", \"m5.2xlarge\", \"m5.4xlarge\" ],\n        \"Default\" : \"m5.large\",\n        \"Description\" : \"Amazon EC2 instance type for the second Active Directory Domain Controller instance\",\n        \"Type\" : \"String\"\n      },\n      \"ADServer2NetBIOSName\" : {\n        \"AllowedPattern\" : \"[a-zA-Z0-9\\\\-]+\",\n        \"Default\" : \"DC2\",\n        \"Description\" : \"NetBIOS name of the second Active Directory Domain Controller (up to 15 characters)\",\n        \"MaxLength\" : \"15\",\n        \"MinLength\" : \"1\",\n        \"Type\" : \"String\"\n      },\n      \"ADServer2PrivateIP\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$\",\n        \"Default\" : \"10.0.32.10\",\n        \"Description\" : \"Fixed private IP for the second Active Directory Domain Controller located in Availability Zone 2 Availability Zone 2\",\n        \"Type\" : \"String\"\n      },\n      \"ADServerEnableAdvancedAudtingandMetrics\" : {\n        \"Description\" : \"Enable advanced auditing and metrics and upload them to CloudWatch using the Amazon Kinesis Agent for Microsoft Windows\",\n        \"AllowedValues\" : [ \"true\", \"false\" ],\n        \"Type\" : \"String\",\n        \"Default\" : \"false\"\n      },\n      \"AvailabilityZones\" : {\n        \"Description\" : \"List of Availability Zones to use for the subnets in the VPC. Note: The logical order is preserved and only 2 AZs are used for this deployment\",\n        \"Type\" : \"List<AWS::EC2::AvailabilityZone::Name>\"\n      },\n      \"CaDataDriveSizeGiB\" : {\n        \"Default\" : \"2\",\n        \"Description\" : \"Size of the data drive in GiB for the CA instance(s)\",\n        \"Type\" : \"Number\"\n      },\n      \"CaHashAlgorithm\" : {\n        \"AllowedValues\" : [ \"SHA256\", \"SHA384\", \"SHA512\" ],\n        \"Default\" : \"SHA256\",\n        \"Description\" : \"CA(s) Hash Algorithm for Siging Certificates\",\n        \"Type\" : \"String\"\n      },\n      \"CaKeyLength\" : {\n        \"AllowedValues\" : [ \"2048\", \"4096\" ],\n        \"Default\" : \"2048\",\n        \"Description\" : \"CA(s) Cryptographic Provider Key Length\",\n        \"Type\" : \"String\"\n      },\n      \"CaServerInstanceType\" : {\n        \"AllowedValues\" : [ \"t3.small\", \"t3.medium\", \"t3.large\", \"t3.xlarge\", \"t3.2xlarge\", \"m5.large\", \"m5.xlarge\", \"m5.2xlarge\", \"m5.4xlarge\" ],\n        \"Default\" : \"t3.medium\",\n        \"Description\" : \"Amazon EC2 instance type for the CA instance(s)\",\n        \"Type\" : \"String\"\n      },\n      \"CaValidityPeriodUnits\" : {\n        \"Default\" : \"5\",\n        \"Description\" : \"Validity Period in Years\",\n        \"Type\" : \"String\"\n      },\n      \"CreateDefaultOUs\" : {\n        \"AllowedValues\" : [ \"Yes\", \"No\" ],\n        \"Default\" : \"No\",\n        \"Description\" : \"Domain Elevated Accounts, Domain Users, Domain Computers, Domain Servers, Domain Service Accounts, and Domain Groups OUs and set the default users and computers containers to Domain Users and Domain Computers\",\n        \"Type\" : \"String\"\n      },\n      \"DHCPOptionSet\" : {\n        \"AllowedValues\" : [ \"Yes\", \"No\" ],\n        \"Default\" : \"Yes\",\n        \"Description\" : \"Do you want to create and apply a new DHCP Options Set\",\n        \"Type\" : \"String\"\n      },\n      \"DataDriveSizeGiB\" : {\n        \"Default\" : \"10\",\n        \"Description\" : \"Size of SYSVOL and NTDS data drive in GiB\",\n        \"Type\" : \"Number\"\n      },\n      \"DeletedObjectLifetime\" : {\n        \"Default\" : \"180\",\n        \"Description\" : \"The number of days before a deleted object is removed from the Active Directory recycling bin, minimum number is 2\",\n        \"Type\" : \"Number\"\n      },\n      \"DomainAdminPassword\" : {\n        \"AllowedPattern\" : \"(?=^.{6,255}$)((?=.*\\\\d)(?=.*[A-Z])(?=.*[a-z])|(?=.*\\\\d)(?=.*[^A-Za-z0-9])(?=.*[a-z])|(?=.*[^A-Za-z0-9])(?=.*[A-Z])(?=.*[a-z])|(?=.*\\\\d)(?=.*[A-Z])(?=.*[^A-Za-z0-9]))^.*\",\n        \"Description\" : \"Password for the account named above. Must be at least 8 characters containing letters, numbers and symbols\",\n        \"MaxLength\" : \"32\",\n        \"MinLength\" : \"8\",\n        \"NoEcho\" : \"true\",\n        \"Type\" : \"String\"\n      },\n      \"DomainAdminUser\" : {\n        \"AllowedPattern\" : \"[a-zA-Z0-9]*\",\n        \"Default\" : \"Admin\",\n        \"Description\" : \"User name for the account that will be added as a Domain Administrator. This is separate from the default \\\"Administrator\\\" account\",\n        \"MaxLength\" : \"25\",\n        \"MinLength\" : \"5\",\n        \"Type\" : \"String\"\n      },\n      \"DomainDNSName\" : {\n        \"AllowedPattern\" : \"[a-zA-Z0-9\\\\-]+\\\\..+\",\n        \"Default\" : \"example.com\",\n        \"Description\" : \"Fully qualified domain name (FQDN) of the forest root domain e.g. example.com\",\n        \"MaxLength\" : \"255\",\n        \"MinLength\" : \"2\",\n        \"Type\" : \"String\"\n      },\n      \"DomainNetBIOSName\" : {\n        \"AllowedPattern\" : \"[a-zA-Z0-9\\\\-]+\",\n        \"Default\" : \"example\",\n        \"Description\" : \"NetBIOS name of the domain (up to 15 characters) for users of earlier versions of Windows e.g. EXAMPLE\",\n        \"MaxLength\" : \"15\",\n        \"MinLength\" : \"1\",\n        \"Type\" : \"String\"\n      },\n      \"EntCaServerNetBIOSName\" : {\n        \"AllowedPattern\" : \"[a-zA-Z0-9\\\\-]+\",\n        \"Default\" : \"ENTCA1\",\n        \"Description\" : \"NetBIOS name of the Enterprise Root or Subordinate CA server (up to 15 characters)\",\n        \"MaxLength\" : \"15\",\n        \"MinLength\" : \"1\",\n        \"Type\" : \"String\"\n      },\n      \"KeyPairName\" : {\n        \"Description\" : \"Public/private key pairs allow you to securely connect to your instance after it launches\",\n        \"Type\" : \"AWS::EC2::KeyPair::KeyName\"\n      },\n      \"NumberOfAZs\" : {\n        \"AllowedValues\" : [ \"2\", \"3\" ],\n        \"Default\" : \"2\",\n        \"Description\" : \"Number of Availability Zones to use in the VPC. This must match your selections in the list of Availability Zones parameter\",\n        \"Type\" : \"String\"\n      },\n      \"NumberOfRDGWHosts\" : {\n        \"AllowedValues\" : [ \"0\", \"1\", \"2\", \"3\", \"4\" ],\n        \"Default\" : \"0\",\n        \"Description\" : \"Enter the number of Remote Desktop Gateway instances to create\",\n        \"Type\" : \"String\"\n      },\n      \"OrCaServerNetBIOSName\" : {\n        \"AllowedPattern\" : \"[a-zA-Z0-9\\\\-]+\",\n        \"Default\" : \"ORCA1\",\n        \"Description\" : \"NetBIOS name of the Offline Root CA server (Only Used For Two Tier PKI) (up to 15 characters)\",\n        \"MaxLength\" : \"15\",\n        \"MinLength\" : \"1\",\n        \"Type\" : \"String\"\n      },\n      \"OrCaValidityPeriodUnits\" : {\n        \"Default\" : \"10\",\n        \"Description\" : \"Validity Period in Years (Only Used For Two Tier PKI)\",\n        \"Type\" : \"String\"\n      },\n      \"PKI\" : {\n        \"AllowedValues\" : [ \"One-Tier\", \"Two-Tier\", \"No\" ],\n        \"Default\" : \"No\",\n        \"Description\" : \"Deploy Two Tier (Offline Root with Subordinate Enterprise CA) or One Tier (Enterprise Root CA) PKI Infrastructure\",\n        \"Type\" : \"String\"\n      },\n      \"PrivateSubnet1CIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/(1[6-9]|2[0-8]))$\",\n        \"ConstraintDescription\" : \"CIDR block parameter must be in the form x.x.x.x/16-28\",\n        \"Default\" : \"10.0.0.0/19\",\n        \"Description\" : \"CIDR block for private subnet 1 located in Availability Zone 1\",\n        \"Type\" : \"String\"\n      },\n      \"PrivateSubnet2CIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/(1[6-9]|2[0-8]))$\",\n        \"ConstraintDescription\" : \"CIDR block parameter must be in the form x.x.x.x/16-28\",\n        \"Default\" : \"10.0.32.0/19\",\n        \"Description\" : \"CIDR block for private subnet 2 located in Availability Zone 2\",\n        \"Type\" : \"String\"\n      },\n      \"PrivateSubnet3CIDR\" : {\n        \"Default\" : \"\",\n        \"Description\" : \"CIDR block for private subnet 3 located in Availability Zone 3\",\n        \"Type\" : \"String\"\n      },\n      \"PublicSubnet1CIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/(1[6-9]|2[0-8]))$\",\n        \"ConstraintDescription\" : \"CIDR block parameter must be in the form x.x.x.x/16-28\",\n        \"Default\" : \"10.0.128.0/20\",\n        \"Description\" : \"CIDR Block for the public subnet 1 located in Availability Zone 1\",\n        \"Type\" : \"String\"\n      },\n      \"PublicSubnet2CIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/(1[6-9]|2[0-8]))$\",\n        \"ConstraintDescription\" : \"CIDR block parameter must be in the form x.x.x.x/16-28\",\n        \"Default\" : \"10.0.144.0/20\",\n        \"Description\" : \"CIDR Block for the public subnet 2 located in Availability Zone 2\",\n        \"Type\" : \"String\"\n      },\n      \"PublicSubnet3CIDR\" : {\n        \"Default\" : \"\",\n        \"Description\" : \"CIDR Block for the public subnet 3 located in Availability Zone 3\",\n        \"Type\" : \"String\"\n      },\n      \"QSS3BucketName\" : {\n        \"AllowedPattern\" : \"^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$\",\n        \"ConstraintDescription\" : \"Quick Start bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-)\",\n        \"Default\" : \"aws-quickstart\",\n        \"Description\" : \"S3 bucket name for the Quick Start assets. Quick Start bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-)\",\n        \"Type\" : \"String\"\n      },\n      \"QSS3BucketRegion\" : {\n        \"Default\" : \"us-east-1\",\n        \"Description\" : \"The AWS Region where the Quick Start S3 bucket (QSS3BucketName) is hosted. When using your own bucket, you must specify this value\",\n        \"Type\" : \"String\"\n      },\n      \"QSS3KeyPrefix\" : {\n        \"AllowedPattern\" : \"^[0-9a-zA-Z-/]*$\",\n        \"ConstraintDescription\" : \"Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/)\",\n        \"Default\" : \"quickstart-microsoft-activedirectory/\",\n        \"Description\" : \"S3 key prefix for the Quick Start assets. Quick Start key prefix can include numbers, lowercase letters, uppercase letters, hyphens (-), and forward slash (/)\",\n        \"Type\" : \"String\"\n      },\n      \"RDGWCIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/([0-9]|[1-2][0-9]|3[0-2]))$\",\n        \"ConstraintDescription\" : \"CIDR block parameter must be in the form x.x.x.x/x\",\n        \"Default\" : \"10.0.0.0/16\",\n        \"Description\" : \"Allowed CIDR Block for external access to the Remote Desktop Gateways\",\n        \"Type\" : \"String\"\n      },\n      \"RDGWInstanceType\" : {\n        \"AllowedValues\" : [ \"t2.small\", \"t2.medium\", \"t2.large\", \"t3.micro\", \"t3.small\", \"t3.medium\", \"t3.large\", \"t3.xlarge\", \"t3.2xlarge\", \"t3a.micro\", \"t3a.small\", \"t3a.medium\", \"t3a.large\", \"t3a.xlarge\", \"t3a.2xlarge\", \"m5.large\", \"m5.xlarge\", \"m5.2xlarge\", \"m5.4xlarge\", \"m5a.large\", \"m5a.xlarge\", \"m5a.2xlarge\" ],\n        \"Default\" : \"t3.large\",\n        \"Description\" : \"Amazon EC2 instance type for the Remote Desktop Gateway instances\",\n        \"Type\" : \"String\"\n      },\n      \"SetupAppInsightsMonitoring\" : {\n        \"AllowedValues\" : [ \"true\", \"false\" ],\n        \"ConstraintDescription\" : \"Can include either true or false.\",\n        \"Default\" : \"false\",\n        \"Description\" : \"Setup Application Insights monitoring for Active Directory resources. This parameter can include either true or false.\",\n        \"Type\" : \"String\"\n      },\n      \"S3CRLBucketName\" : {\n        \"AllowedPattern\" : \"^[0-9a-zA-Z]+([0-9a-zA-Z-]*[0-9a-zA-Z])*$\",\n        \"Default\" : \"examplebucket\",\n        \"Description\" : \"S3 bucket name for CA CRL(s) storage. Bucket name can include numbers, lowercase letters, uppercase letters, and hyphens (-). It cannot start or end with a hyphen (-)\",\n        \"Type\" : \"String\"\n      },\n      \"TombstoneLifetime\" : {\n        \"Default\" : \"180\",\n        \"Description\" : \"The number of days before a deleted object is removed from Active Directory, minimum number is 2\",\n        \"Type\" : \"Number\"\n      },\n      \"UseS3ForCRL\" : {\n        \"AllowedValues\" : [ \"Yes\", \"No\" ],\n        \"Default\" : \"No\",\n        \"Description\" : \"Store CA CRL(s) in an S3 bucket\",\n        \"Type\" : \"String\"\n      },\n      \"VPCCIDR\" : {\n        \"AllowedPattern\" : \"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\\\\/(1[6-9]|2[0-8]))$\",\n        \"ConstraintDescription\" : \"CIDR block parameter must be in the form x.x.x.x/16-28\",\n        \"Default\" : \"10.0.0.0/16\",\n        \"Description\" : \"CIDR Block for the VPC\",\n        \"Type\" : \"String\"\n      }\n    },\n    \"Conditions\" : {\n      \"AppInsightsEnabled\" : {\n        \"Fn::Equals\" : [ {\n          \"Ref\" : \"SetupAppInsightsMonitoring\"\n        }, true ]\n      },\n      \"IncludeRDGW\" : {\n        \"Fn::Not\" : [ {\n          \"Fn::Equals\" : [ {\n            \"Ref\" : \"NumberOfRDGWHosts\"\n          }, \"0\" ]\n        } ]\n      },\n      \"IsTwoAz\" : {\n        \"Fn::Equals\" : [ {\n          \"Ref\" : \"NumberOfAZs\"\n        }, \"2\" ]\n      },\n      \"UsingDefaultBucket\" : {\n        \"Fn::Equals\" : [ {\n          \"Ref\" : \"QSS3BucketName\"\n        }, \"aws-quickstart\" ]\n      }\n    },\n    \"Rules\" : {\n      \"CheckSupportedInstances\" : {\n        \"RuleCondition\" : {\n          \"Fn::Or\" : [ {\n            \"Fn::Contains\" : [ [ \"m4.large\", \"m4.xlarge\", \"m4.2xlarge\", \"m4.4xlarge\" ], {\n              \"Ref\" : \"ADServer1InstanceType\"\n            } ]\n          }, {\n            \"Fn::Contains\" : [ [ \"m4.large\", \"m4.xlarge\", \"m4.2xlarge\", \"m4.4xlarge\" ], {\n              \"Ref\" : \"ADServer2InstanceType\"\n            } ]\n          } ]\n        },\n        \"Assertions\" : [ {\n          \"Assert\" : {\n            \"Fn::Not\" : [ {\n              \"Fn::Contains\" : [ [ \"eu-west-3\" ], {\n                \"Ref\" : \"AWS::Region\"\n              } ]\n            } ]\n          },\n          \"AssertDescription\" : \"M4 instances are not available in the Paris region\"\n        } ]\n      },\n      \"S3CRLBucketNameValidation\" : {\n        \"RuleCondition\" : {\n          \"Fn::And\" : [ {\n            \"Fn::Equals\" : [ {\n              \"Ref\" : \"UseS3ForCRL\"\n            }, \"Yes\" ]\n          }, {\n            \"Fn::Not\" : [ {\n              \"Fn::Equals\" : [ {\n                \"Ref\" : \"PKI\"\n              }, \"No\" ]\n            } ]\n          } ]\n        },\n        \"Assertions\" : [ {\n          \"AssertDescription\" : \"CRL BucketName cannot must be valid BucketName\",\n          \"Assert\" : {\n            \"Fn::Not\" : [ {\n              \"Fn::Equals\" : [ {\n                \"Ref\" : \"S3CRLBucketName\"\n              }, \"examplebucket\" ]\n            } ]\n          }\n        } ]\n      }\n    },\n    \"Resources\" : {\n      \"VPCStack\" : {\n        \"Type\" : \"AWS::CloudFormation::Stack\",\n        \"Properties\" : {\n          \"TemplateURL\" : {\n            \"Fn::Sub\" : \"ssm-doc://arn:${AWS::Partition}:ssm:${AWS::Region}::document/AWSQuickStarts-AWS-VPC\"\n          },\n          \"Parameters\" : {\n            \"AvailabilityZones\" : {\n              \"Fn::Join\" : [ \",\", {\n                \"Ref\" : \"AvailabilityZones\"\n              } ]\n            },\n            \"NumberOfAZs\" : {\n              \"Fn::If\" : [ \"IsTwoAz\", \"2\", \"3\" ]\n            },\n            \"PrivateSubnet1ACIDR\" : {\n              \"Ref\" : \"PrivateSubnet1CIDR\"\n            },\n            \"PrivateSubnet2ACIDR\" : {\n              \"Ref\" : \"PrivateSubnet2CIDR\"\n            },\n            \"PrivateSubnet3ACIDR\" : {\n              \"Fn::If\" : [ \"IsTwoAz\", {\n                \"Ref\" : \"AWS::NoValue\"\n              }, {\n                \"Ref\" : \"PrivateSubnet3CIDR\"\n              } ]\n            },\n            \"PublicSubnet1CIDR\" : {\n              \"Ref\" : \"PublicSubnet1CIDR\"\n            },\n            \"PublicSubnet2CIDR\" : {\n              \"Ref\" : \"PublicSubnet2CIDR\"\n            },\n            \"PublicSubnet3CIDR\" : {\n              \"Fn::If\" : [ \"IsTwoAz\", {\n                \"Ref\" : \"AWS::NoValue\"\n              }, {\n                \"Ref\" : \"PublicSubnet3CIDR\"\n              } ]\n            },\n            \"VPCCIDR\" : {\n              \"Ref\" : \"VPCCIDR\"\n            }\n          }\n        }\n      },\n      \"ADStack\" : {\n        \"Type\" : \"AWS::CloudFormation::Stack\",\n        \"Properties\" : {\n          \"TemplateURL\" : {\n            \"Fn::Sub\" : \"ssm-doc://arn:${AWS::Partition}:ssm:${AWS::Region}::document/AWSQuickStarts-Microsoft-AD-SelfManaged-Existing-VPC\"\n          },\n          \"Parameters\" : {\n            \"ADServer1InstanceType\" : {\n              \"Ref\" : \"ADServer1InstanceType\"\n            },\n            \"ADServer1NetBIOSName\" : {\n              \"Ref\" : \"ADServer1NetBIOSName\"\n            },\n            \"ADServer1PrivateIP\" : {\n              \"Ref\" : \"ADServer1PrivateIP\"\n            },\n            \"ADServer2InstanceType\" : {\n              \"Ref\" : \"ADServer2InstanceType\"\n            },\n            \"ADServer2NetBIOSName\" : {\n              \"Ref\" : \"ADServer2NetBIOSName\"\n            },\n            \"ADServer2PrivateIP\" : {\n              \"Ref\" : \"ADServer2PrivateIP\"\n            },\n            \"EnableAdvancedAudtingandMetrics\" : {\n              \"Ref\" : \"ADServerEnableAdvancedAudtingandMetrics\"\n            },\n            \"CaDataDriveSizeGiB\" : {\n              \"Ref\" : \"CaDataDriveSizeGiB\"\n            },\n            \"CaHashAlgorithm\" : {\n              \"Ref\" : \"CaHashAlgorithm\"\n            },\n            \"CaKeyLength\" : {\n              \"Ref\" : \"CaKeyLength\"\n            },\n            \"CaServerInstanceType\" : {\n              \"Ref\" : \"CaServerInstanceType\"\n            },\n            \"CaValidityPeriodUnits\" : {\n              \"Ref\" : \"CaValidityPeriodUnits\"\n            },\n            \"CreateDefaultOUs\" : {\n              \"Ref\" : \"CreateDefaultOUs\"\n            },\n            \"DHCPOptionSet\" : {\n              \"Ref\" : \"DHCPOptionSet\"\n            },\n            \"DataDriveSizeGiB\" : {\n              \"Ref\" : \"DataDriveSizeGiB\"\n            },\n            \"DeletedObjectLifetime\" : {\n              \"Ref\" : \"DeletedObjectLifetime\"\n            },\n            \"DomainAdminPassword\" : {\n              \"Ref\" : \"DomainAdminPassword\"\n            },\n            \"DomainAdminUser\" : {\n              \"Ref\" : \"DomainAdminUser\"\n            },\n            \"DomainDNSName\" : {\n              \"Ref\" : \"DomainDNSName\"\n            },\n            \"DomainNetBIOSName\" : {\n              \"Ref\" : \"DomainNetBIOSName\"\n            },\n            \"EntCaServerNetBIOSName\" : {\n              \"Ref\" : \"EntCaServerNetBIOSName\"\n            },\n            \"KeyPairName\" : {\n              \"Ref\" : \"KeyPairName\"\n            },\n            \"OrCaServerNetBIOSName\" : {\n              \"Ref\" : \"OrCaServerNetBIOSName\"\n            },\n            \"OrCaValidityPeriodUnits\" : {\n              \"Ref\" : \"OrCaValidityPeriodUnits\"\n            },\n            \"PKI\" : {\n              \"Ref\" : \"PKI\"\n            },\n            \"PrivateSubnet1ID\" : {\n              \"Fn::GetAtt\" : [ \"VPCStack\", \"Outputs.PrivateSubnet1AID\" ]\n            },\n            \"PrivateSubnet2ID\" : {\n              \"Fn::GetAtt\" : [ \"VPCStack\", \"Outputs.PrivateSubnet2AID\" ]\n            },\n            \"QSS3BucketName\" : {\n              \"Ref\" : \"QSS3BucketName\"\n            },\n            \"QSS3BucketRegion\" : {\n              \"Ref\" : \"QSS3BucketRegion\"\n            },\n            \"QSS3KeyPrefix\" : {\n              \"Ref\" : \"QSS3KeyPrefix\"\n            },\n            \"SetupAppInsightsMonitoring\" : {\n              \"Ref\" : \"SetupAppInsightsMonitoring\"\n            },\n            \"S3CRLBucketName\" : {\n              \"Ref\" : \"S3CRLBucketName\"\n            },\n            \"TombstoneLifetime\" : {\n              \"Ref\" : \"TombstoneLifetime\"\n            },\n            \"UseS3ForCRL\" : {\n              \"Ref\" : \"UseS3ForCRL\"\n            },\n            \"VPCCIDR\" : {\n              \"Ref\" : \"VPCCIDR\"\n            },\n            \"VPCID\" : {\n              \"Fn::GetAtt\" : [ \"VPCStack\", \"Outputs.VPCID\" ]\n            }\n          }\n        }\n      },\n      \"RDGWStack\" : {\n        \"Condition\" : \"IncludeRDGW\",\n        \"Type\" : \"AWS::CloudFormation::Stack\",\n        \"Properties\" : {\n          \"TemplateURL\" : {\n            \"Fn::Sub\" : \"ssm-doc://arn:${AWS::Partition}:ssm:${AWS::Region}::document/AWSQuickStarts-Microsoft-RdGateway-Domain-Joined\"\n          },\n          \"Parameters\" : {\n            \"DomainAdminPassword\" : {\n              \"Ref\" : \"DomainAdminPassword\"\n            },\n            \"DomainAdminUser\" : {\n              \"Ref\" : \"DomainAdminUser\"\n            },\n            \"DomainDNSName\" : {\n              \"Ref\" : \"DomainDNSName\"\n            },\n            \"DomainMemberSGID\" : {\n              \"Fn::GetAtt\" : [ \"ADStack\", \"Outputs.DomainMemberSGID\" ]\n            },\n            \"DomainNetBIOSName\" : {\n              \"Ref\" : \"DomainNetBIOSName\"\n            },\n            \"KeyPairName\" : {\n              \"Ref\" : \"KeyPairName\"\n            },\n            \"NumberOfRDGWHosts\" : {\n              \"Ref\" : \"NumberOfRDGWHosts\"\n            },\n            \"PublicSubnet1ID\" : {\n              \"Fn::GetAtt\" : [ \"VPCStack\", \"Outputs.PublicSubnet1ID\" ]\n            },\n            \"PublicSubnet2ID\" : {\n              \"Fn::GetAtt\" : [ \"VPCStack\", \"Outputs.PublicSubnet2ID\" ]\n            },\n            \"QSS3BucketName\" : {\n              \"Ref\" : \"QSS3BucketName\"\n            },\n            \"QSS3BucketRegion\" : {\n              \"Ref\" : \"QSS3BucketRegion\"\n            },\n            \"QSS3KeyPrefix\" : {\n              \"Fn::Sub\" : \"${QSS3KeyPrefix}submodules/quickstart-microsoft-rdgateway/\"\n            },\n            \"RDGWCIDR\" : {\n              \"Ref\" : \"RDGWCIDR\"\n            },\n            \"RDGWInstanceType\" : {\n              \"Ref\" : \"RDGWInstanceType\"\n            },\n            \"VPCID\" : {\n              \"Fn::GetAtt\" : [ \"VPCStack\", \"Outputs.VPCID\" ]\n            }\n          }\n        }\n      }\n    }\n  }\n}",
  "CreatedDate": "2022-11-14T14:46:07.349Z",
  "DisplayName": null,
  "DocumentFormat": {
    "Value": "JSON"
  },
  "DocumentType": {
    "Value": "CloudFormation"
  },
  "DocumentVersion": "7",
  "Name": "AWSQuickStarts-Microsoft-AD-SelfManaged",
  "Requires": [],
  "ReviewStatus": null,
  "Status": {
    "Value": "Active"
  },
  "StatusInformation": null,
  "VersionName": "AWSQuickStarts-Microsoft-AD-SelfManaged-2022-11-14-14-37-24",
  "ResponseMetadata": {
    "RequestId": "88e9a7e3-5059-45ad-8d2a-805fab513347",
    "Metadata": {},
    "ChecksumAlgorithm": 0,
    "ChecksumValidationStatus": 0
  },
  "ContentLength": 34635,
  "HttpStatusCode": 200,
  "LoggedAt": "2022-12-14T07:12:43.381665+00:00"
}
