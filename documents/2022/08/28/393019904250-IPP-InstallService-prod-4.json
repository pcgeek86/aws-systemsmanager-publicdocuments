{
  "AttachmentsContent": [],
  "Content": "{\n  \"schemaVersion\" : \"2.2\",\n  \"description\" : \"Install IPP Service\",\n  \"parameters\" : {\n    \"s3UrlBase\" : {\n      \"type\" : \"String\",\n      \"default\" : \"https://s3-us-west-2.amazonaws.com\"\n    },\n    \"s3Bucket\" : {\n      \"type\" : \"String\"\n    },\n    \"s3UrlVersion\" : {\n      \"type\" : \"String\",\n      \"default\" : \"latest\"\n    },\n    \"usvctl\" : {\n      \"type\" : \"String\",\n      \"default\" : \"usvctl\"\n    },\n    \"packgeName\" : {\n      \"type\" : \"String\"\n    },\n    \"packgeConfigName\" : {\n      \"type\" : \"String\"\n    },\n    \"packgeArgsLinux\" : {\n      \"type\" : \"String\"\n    },\n    \"packgeArgsWindows\" : {\n      \"type\" : \"String\"\n    },\n    \"directoryLinux\" : {\n      \"type\" : \"String\",\n      \"default\" : \"/usr/local/ipp\"\n    },\n    \"directoryWindows\" : {\n      \"type\" : \"String\",\n      \"default\" : \"C:\\\\Program Files\\\\ipp\"\n    },\n    \"configLinux\" : {\n      \"type\" : \"String\"\n    },\n    \"configWindows\" : {\n      \"type\" : \"String\"\n    }\n  },\n  \"mainSteps\" : [ {\n    \"action\" : \"aws:runPowerShellScript\",\n    \"name\" : \"windows_1_prepare_env\",\n    \"precondition\" : {\n      \"StringEquals\" : [ \"platformType\", \"Windows\" ]\n    },\n    \"inputs\" : {\n      \"runCommand\" : [ \"New-Item -ItemType directory -Force -Path \\\"{{ directoryWindows }}\\\\{{ packgeName }}\\\"\" ]\n    }\n  }, {\n    \"action\" : \"aws:downloadContent\",\n    \"name\" : \"windows_2_download_usvctl\",\n    \"precondition\" : {\n      \"StringEquals\" : [ \"platformType\", \"Windows\" ]\n    },\n    \"inputs\" : {\n      \"sourceType\" : \"S3\",\n      \"sourceInfo\" : \"{\\\"path\\\": \\\"{{ s3UrlBase }}/{{ s3Bucket }}/{{ s3UrlVersion }}/exec/amd64/windows/{{ usvctl }}.exe\\\"}\",\n      \"destinationPath\" : \"{{ directoryWindows }}\\\\{{ packgeName }}\\\\\"\n    }\n  }, {\n    \"action\" : \"aws:runPowerShellScript\",\n    \"name\" : \"windows_3_stop_service\",\n    \"precondition\" : {\n      \"StringEquals\" : [ \"platformType\", \"Windows\" ]\n    },\n    \"inputs\" : {\n      \"workingDirectory\" : \"{{ directoryWindows }}\\\\{{ packgeName }}\",\n      \"runCommand\" : [ \"& .\\\\{{ usvctl }}.exe stop --name {{ packgeName }}\" ]\n    }\n  }, {\n    \"action\" : \"aws:downloadContent\",\n    \"name\" : \"windows_4_download_package\",\n    \"precondition\" : {\n      \"StringEquals\" : [ \"platformType\", \"Windows\" ]\n    },\n    \"inputs\" : {\n      \"sourceType\" : \"S3\",\n      \"sourceInfo\" : \"{\\\"path\\\": \\\"{{ s3UrlBase }}/{{ s3Bucket }}/{{ s3UrlVersion }}/exec/amd64/windows/{{ packgeName }}.exe\\\"}\",\n      \"destinationPath\" : \"{{ directoryWindows }}\\\\{{ packgeName }}\\\\\"\n    }\n  }, {\n    \"action\" : \"aws:runPowerShellScript\",\n    \"name\" : \"windows_5_create_package_config\",\n    \"precondition\" : {\n      \"StringEquals\" : [ \"platformType\", \"Windows\" ]\n    },\n    \"inputs\" : {\n      \"workingDirectory\" : \"{{ directoryWindows }}\\\\{{ packgeName }}\",\n      \"runCommand\" : [ \"Echo @\\\"\", \"{{ configWindows }}\", \"\\\"@ > {{ packgeConfigName }}.echo\", \"$echoFile = Get-Content \\\"{{ packgeConfigName }}.echo\\\"\", \"$Utf8NoBomEncoding = New-Object System.Text.UTF8Encoding $False\", \"[System.IO.File]::WriteAllLines(\\\"{{ packgeConfigName }}\\\", $echoFile, $Utf8NoBomEncoding)\", \"If (-Not $?) { Exit 1 }\" ]\n    }\n  }, {\n    \"action\" : \"aws:runPowerShellScript\",\n    \"name\" : \"windows_6_install_service\",\n    \"precondition\" : {\n      \"StringEquals\" : [ \"platformType\", \"Windows\" ]\n    },\n    \"inputs\" : {\n      \"workingDirectory\" : \"{{ directoryWindows }}\\\\{{ packgeName }}\",\n      \"runCommand\" : [ \"& .\\\\{{ usvctl }}.exe stop --name {{ packgeName }}\", \"& .\\\\{{ usvctl }}.exe install --name {{ packgeName }} --exec=\\\"{{ directoryWindows }}\\\\{{ packgeName }}\\\\{{ packgeName }}.exe\\\" --args=\\\"{{ packgeArgsWindows }}\\\"\", \"& .\\\\{{ usvctl }}.exe start --name {{ packgeName }}\", \"If (-Not $?) { Exit 1 }\" ]\n    }\n  }, {\n    \"action\" : \"aws:runShellScript\",\n    \"name\" : \"linux_1_prepare_env\",\n    \"precondition\" : {\n      \"StringEquals\" : [ \"platformType\", \"Linux\" ]\n    },\n    \"inputs\" : {\n      \"runCommand\" : [ \"mkdir -p {{ directoryLinux }}/{{ packgeName }}\" ]\n    }\n  }, {\n    \"action\" : \"aws:downloadContent\",\n    \"name\" : \"linux_2_download_package\",\n    \"precondition\" : {\n      \"StringEquals\" : [ \"platformType\", \"Linux\" ]\n    },\n    \"inputs\" : {\n      \"sourceType\" : \"S3\",\n      \"sourceInfo\" : \"{\\\"path\\\": \\\"{{ s3UrlBase }}/{{ s3Bucket }}/{{ s3UrlVersion }}/exec/amd64/linux/{{ packgeName }}\\\"}\",\n      \"destinationPath\" : \"{{ directoryLinux }}/{{ packgeName }}/\"\n    }\n  }, {\n    \"action\" : \"aws:downloadContent\",\n    \"name\" : \"linux_4_download_usvctl_linux\",\n    \"precondition\" : {\n      \"StringEquals\" : [ \"platformType\", \"Linux\" ]\n    },\n    \"inputs\" : {\n      \"sourceType\" : \"S3\",\n      \"sourceInfo\" : \"{\\\"path\\\": \\\"{{ s3UrlBase }}/{{ s3Bucket }}/{{ s3UrlVersion }}/exec/amd64/linux/{{ usvctl }}\\\"}\",\n      \"destinationPath\" : \"{{ directoryLinux }}/{{ packgeName }}/\"\n    }\n  }, {\n    \"action\" : \"aws:runShellScript\",\n    \"name\" : \"linux_5_create_package_config\",\n    \"precondition\" : {\n      \"StringEquals\" : [ \"platformType\", \"Linux\" ]\n    },\n    \"inputs\" : {\n      \"workingDirectory\" : \"{{ directoryLinux }}/{{ packgeName }}\",\n      \"runCommand\" : [ \"cat > ./{{ packgeConfigName }} <<- \\\"ENDOFFILE\\\"\", \"{{ configLinux }}\", \"ENDOFFILE\" ]\n    }\n  }, {\n    \"action\" : \"aws:runShellScript\",\n    \"name\" : \"linux_6_install_package\",\n    \"precondition\" : {\n      \"StringEquals\" : [ \"platformType\", \"Linux\" ]\n    },\n    \"inputs\" : {\n      \"workingDirectory\" : \"{{ directoryLinux }}/{{ packgeName }}\",\n      \"runCommand\" : [ \"#!/usr/bin/env bash\", \"set +e\", \"echo \\\"allowing command to failure\\\"\", \"./{{ usvctl }} stop --name {{ packgeName }}\", \"./{{ usvctl }} install --name {{ packgeName }} --exec=\\\"{{ directoryLinux }}/{{ packgeName }}/{{ packgeName }}\\\" --args=\\\"{{ packgeArgsLinux }}\\\"\", \"./{{ usvctl }} start --name {{ packgeName }}\" ]\n    }\n  } ]\n}",
  "CreatedDate": "2020-05-21T08:33:02.626Z",
  "DisplayName": null,
  "DocumentFormat": {
    "Value": "JSON"
  },
  "DocumentType": {
    "Value": "Command"
  },
  "DocumentVersion": "4",
  "Name": "arn:aws:ssm:us-west-2:393019904250:document/IPP-InstallService-prod",
  "Requires": [],
  "ReviewStatus": null,
  "Status": {
    "Value": "Active"
  },
  "StatusInformation": null,
  "VersionName": null,
  "ResponseMetadata": {
    "RequestId": "9c644e9d-a6bb-42a1-a136-a0a8837af0d5",
    "Metadata": {},
    "ChecksumAlgorithm": 0,
    "ChecksumValidationStatus": 0
  },
  "ContentLength": 6604,
  "HttpStatusCode": 200,
  "LoggedAt": "2022-08-28T07:13:29.1531902+00:00"
}
