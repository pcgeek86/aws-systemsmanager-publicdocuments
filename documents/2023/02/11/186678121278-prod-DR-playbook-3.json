{
  "AttachmentsContent": [],
  "Content": "{\n  \"description\" : \"*DR Runbook.*  \\n\\n---\\n# DR Mock test run (prod env)\\nA sample run of the DR tasks.\\n## Pre-requisites\\nrequires the DR account and DR region to be identified prior to the test.\\nin this case \\n>* DR account: *`production-usw2`*\\n*   DR region : *`us-west-2`*\\n\\nFollowing  *resources* are brought up in warm-mode before hand to speed up DR activity:  \\n1. Resources\\n>* Secrets \\n * REDIS cluster(s)\\n * ElasticSearch Domain(s)\\n* EC2 KeyPairs\\n\\nYou can create a [link to another webpage](https://aws.amazon.com/).\",\n  \"schemaVersion\" : \"0.3\",\n  \"assumeRole\" : \"arn:aws:iam::186678121278:role/production-usw2-drnode-role\",\n  \"mainSteps\" : [ {\n    \"name\" : \"initiateDR\",\n    \"action\" : \"aws:approve\",\n    \"inputs\" : {\n      \"Approvers\" : [ \"arn:aws:iam::249183611969:user/andrew\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/andrew\", \"arn:aws:iam::249183611969:user/vishwas\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/vishwas\", \"arn:aws:iam::249183611969:user/brendan\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/brendan\", \"arn:aws:iam::249183611969:user/ianatkinson\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/ianatkinson\" ]\n    },\n    \"description\" : \"On-call initiates the DR request\"\n  }, {\n    \"name\" : \"approveDR\",\n    \"action\" : \"aws:approve\",\n    \"inputs\" : {\n      \"Approvers\" : [ \"arn:aws:iam::249183611969:user/andrew\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/andrew\", \"arn:aws:iam::249183611969:user/vishwas\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/vishwas\", \"arn:aws:iam::249183611969:user/brendan\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/brendan\", \"arn:aws:iam::249183611969:user/ianatkinson\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/ianatkinson\" ]\n    },\n    \"description\" : \"Engineering mgmt approval for the DR activity\"\n  }, {\n    \"name\" : \"updateCode\",\n    \"action\" : \"aws:runCommand\",\n    \"inputs\" : {\n      \"DocumentName\" : \"updatecode\",\n      \"Parameters\" : {\n        \"accesskeyPath\" : \"/syllable/internal/code/tf-accesskey\",\n        \"workDir\" : \"/home/ssm-user/code2\"\n      },\n      \"InstanceIds\" : [ \"i-02114c359063cafa4\" ]\n    },\n    \"description\" : \"Get latest code updates from syllable repos\"\n  }, {\n    \"name\" : \"updateTFConfigs\",\n    \"action\" : \"aws:runCommand\",\n    \"inputs\" : {\n      \"DocumentName\" : \"update-tf-cfgs\",\n      \"InstanceIds\" : [ \"i-02114c359063cafa4\" ]\n    },\n    \"description\" : \"refresh the terragrunt modules\"\n  }, {\n    \"name\" : \"importLegacyESindices\",\n    \"action\" : \"aws:invokeLambdaFunction\",\n    \"description\" : \"Login to the DR Node and perform the ES restore operation ( Manual invocation for now)\",\n    \"inputs\" : {\n      \"InvocationType\" : \"RequestResponse\",\n      \"FunctionName\" : \"arn:aws:lambda:us-west-2:186678121278:function:esutils-productionesutilsEF6D9AF2-MyLGm0gPfF0x\"\n    },\n    \"timeoutSeconds\" : 600\n  }, {\n    \"name\" : \"triggerServiceBringUp\",\n    \"action\" : \"aws:invokeLambdaFunction\",\n    \"inputs\" : {\n      \"InvocationType\" : \"RequestResponse\",\n      \"FunctionName\" : \"arn:aws:lambda:us-west-2:186678121278:function:tfactions-producer-tfactionsproducer69BB34E6-lEPLJfKP0MJX\"\n    },\n    \"description\" : \"Execute launcher to bring up syllable services (Manual invocation for now)\"\n  }, {\n    \"name\" : \"WaitForServicesTobecomeSteady\",\n    \"action\" : \"aws:sleep\",\n    \"inputs\" : {\n      \"Duration\" : \"PT20M\"\n    },\n    \"description\" : \"Wait for the services to become steady\"\n  }, {\n    \"name\" : \"RunAlexandriaPipeline_Manual\",\n    \"action\" : \"aws:approve\",\n    \"inputs\" : {\n      \"Approvers\" : [ \"arn:aws:iam::249183611969:user/andrew\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/andrew\", \"arn:aws:iam::249183611969:user/vishwas\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/vishwas\", \"arn:aws:iam::249183611969:user/brendan\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/brendan\", \"arn:aws:iam::249183611969:user/ianatkinson\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/ianatkinson\" ]\n    },\n    \"description\" : \"Execute Alexandria pipeline to create the contact indices following https://docs.google.com/document/d/11Ha-5FwucwJg1vdXkzqrUlLqZIIKL4iWZVOPmF_5PyM/edit#heading=h.8ovynjc5hfvp\"\n  }, {\n    \"name\" : \"verifyPhonePath\",\n    \"action\" : \"aws:approve\",\n    \"inputs\" : {\n      \"Approvers\" : [ \"arn:aws:iam::249183611969:user/andrew\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/andrew\", \"arn:aws:iam::249183611969:user/vishwas\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/vishwas\", \"arn:aws:iam::249183611969:user/brendan\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/brendan\", \"arn:aws:iam::249183611969:user/ianatkinson\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/ianatkinson\" ]\n    },\n    \"description\" : \"Perform sheet tests / test phone calls  using 1(681)2022545\"\n  }, {\n    \"name\" : \"createSIPTrunk\",\n    \"action\" : \"aws:invokeLambdaFunction\",\n    \"inputs\" : {\n      \"InvocationType\" : \"RequestResponse\",\n      \"FunctionName\" : \"arn:aws:lambda:us-west-2:186678121278:function:tf-sip-trunk-tfsiptrunk00F5B55A-jBctU2Ih9504\"\n    },\n    \"description\" : \"Provisiojn a SIP trunk for this environment ( Manual invocation for now)\"\n  }, {\n    \"name\" : \"migratePhones\",\n    \"action\" : \"aws:invokeLambdaFunction\",\n    \"inputs\" : {\n      \"InvocationType\" : \"RequestResponse\",\n      \"FunctionName\" : \"arn:aws:lambda:us-west-2:186678121278:function:tf-migrate-phones-tfmigratephones0B6CBA4D-zJbehc5tQvfC\"\n    },\n    \"description\" : \"Migrate existing phones to the new environment (Manual invocation for now ) :\\n  -    (lamarr hook)\\n  -    (winston)\\n  -    (SIP trunk)\"\n  }, {\n    \"name\" : \"verifyMigratedPhones\",\n    \"action\" : \"aws:approve\",\n    \"inputs\" : {\n      \"Approvers\" : [ \"arn:aws:iam::249183611969:user/andrew\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/andrew\", \"arn:aws:iam::249183611969:user/vishwas\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/vishwas\", \"arn:aws:iam::249183611969:user/brendan\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/brendan\", \"arn:aws:iam::249183611969:user/ianatkinson\", \"arn:aws:sts::186678121278:assumed-role/SylDRAdminRole/ianatkinson\" ]\n    },\n    \"description\" : \"Perform tests on the migrated phones for proper call functioning.\"\n  }, {\n    \"name\" : \"completeDR\",\n    \"action\" : \"aws:runCommand\",\n    \"inputs\" : {\n      \"DocumentName\" : \"completeDR\",\n      \"InstanceIds\" : [ \"i-02114c359063cafa4\" ]\n    },\n    \"description\" : \"Post DR checks and completion of DR activity\"\n  } ]\n}",
  "CreatedDate": "2022-08-02T16:00:19.734Z",
  "DisplayName": null,
  "DocumentFormat": {
    "Value": "JSON"
  },
  "DocumentType": {
    "Value": "Automation"
  },
  "DocumentVersion": "3",
  "Name": "arn:aws:ssm:us-west-2:186678121278:document/prod-DR-playbook",
  "Requires": [],
  "ReviewStatus": null,
  "Status": {
    "Value": "Active"
  },
  "StatusInformation": null,
  "VersionName": null,
  "ResponseMetadata": {
    "RequestId": "44c0e215-9f55-4dfa-87e3-ddcfe1294da1",
    "Metadata": {},
    "ChecksumAlgorithm": 0,
    "ChecksumValidationStatus": 0
  },
  "ContentLength": 7257,
  "HttpStatusCode": 200,
  "LoggedAt": "2023-02-11T07:11:53.5799698+00:00"
}
